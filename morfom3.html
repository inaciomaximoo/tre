<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simulador de Provas Personalizado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    
    <audio id="correctSound" src="correct.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="wrong.mp3" preload="auto"></audio>

    <style>
        :root {
            --bg-main: #f0f2f5;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --text-secondary: #555555;
            --primary-color: #3a86ff;
            --primary-light: #69a5ff;
            --primary-dark: #005cbb;
            --accent-color: #2ecc71;
            --accent-light: #e6ffee;
            --danger-color: #e74c3c;
            --danger-light: #ffebee;
            --warning-color: #FF9800; 
            --warning-light: #FFF3E0;
            --border-color: #d1d9e6;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --font-main: 'Poppins', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --border-radius-main: 12px;
            --transition-speed: 0.3s;
            --purple-accent: #7c4dff; 
        }

        .dark-mode {
            --bg-main: #1e1e2f;
            --bg-card: #2a2a3a;
            --text-primary: #e0e0e0;
            --text-secondary: #9e9e9e;
            --primary-color: #7c4dff; 
            --primary-light: #9d7bff;
            --primary-dark: #5e35b1;
            --accent-color: #00e676;
            --accent-light: rgba(0, 230, 118, 0.1);
            --danger-color: #ff5252;
            --danger-light: rgba(255, 82, 82, 0.1);
            --warning-color: #FFA726;
            --warning-light: rgba(255, 167, 38, 0.15);
            --border-color: #424242;
            --shadow-color: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            padding: 20px 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            background: var(--bg-card);
            border-radius: var(--border-radius-main);
            box-shadow: 0 8px 25px var(--shadow-color);
            padding: 25px;
            border: 1px solid var(--border-color);
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }
        
        .header {
            display: flex;
            align-items: center; 
            margin-bottom: 25px;
            gap: 15px;
            width: 100%;
        }
        
        #quizPage .header {
            flex-direction: row; 
            justify-content: space-between; 
        }
        #quizPage .header h1#quizTitle {
            margin-bottom: 0; 
            text-align: left; 
            flex-grow: 1; 
        }
        #quizPage .header .dark-mode-toggle {
            width: auto; 
            margin-bottom: 0;
        }

        
        #resultsPage .header {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }
        #resultsPage .header h1 {
            margin-bottom: 0; 
        }
        #resultsPage .header .dark-mode-toggle {
            margin-bottom: 0; 
            width: auto; 
        }


        h1, h2, h3, h4 {
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 15px;
        }
        h1 { font-size: 1.8rem; text-align: center; }
        h2 { font-size: 1.5rem; }
        h3 { font-size: 1.3rem; text-align: center; }
        h4 { font-size: 1.1rem; color: var(--text-secondary); font-weight: 600; }

        .dark-mode-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            padding: 8px 12px; 
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            box-shadow: 0 2px 5px var(--shadow-color);
            overflow: hidden; 
        }
        
        .dark-mode-toggle:hover {
            background-color: var(--primary-color);
            color: #ffffff;
            border-color: var(--primary-dark);
        }
        .dark-mode .dark-mode-toggle:hover {
            color: #ffffff;
        }

        .icon-container {
            position: relative;
            width: 20px; 
            height: 20px; 
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .moon-icon, .sun-icon {
            position: absolute;
            transition: opacity 0.3s ease-in-out, transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
            font-size: 1rem; 
            line-height: 1;
        }
        .sun-icon {
            opacity: 0;
            transform: translateY(100%) rotate(90deg) scale(0.5); 
        }
        .moon-icon {
            opacity: 1;
            transform: translateY(0) rotate(0deg) scale(1);
        }
        .dark-mode .sun-icon {
            opacity: 1;
            transform: translateY(0) rotate(0deg) scale(1);
        }
        .dark-mode .moon-icon {
            opacity: 0;
            transform: translateY(-100%) rotate(-90deg) scale(0.5); 
        }
        

        .question-container {
            background: var(--bg-card);
            border-radius: var(--border-radius-main);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            transition: border-color var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }

        .question-container.correct {
            border-left: 6px solid var(--accent-color);
            background-color: var(--accent-light);
        }
        .dark-mode .question-container.correct {
            background-color: rgba(0, 230, 118, 0.05);
        }

        .question-container.incorrect {
            border-left: 6px solid var(--danger-color);
            background-color: var(--danger-light);
        }
        .dark-mode .question-container.incorrect {
            background-color: rgba(255, 82, 82, 0.05);
        }

        .question-number {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--primary-color);
            font-weight: 600;
            display: flex; 
            align-items: center; 
        }
        .mistake-stars-container { 
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
        }
        .mistake-stars { 
            font-size: 0.9em; 
            color: var(--purple-accent); 
        }
        .mistake-stars-label {
            font-size: 0.8em;
            color: var(--purple-accent);
            font-weight: normal; 
            margin-left: 4px;
        }


        .question-text {
            margin-bottom: 20px;
            white-space: pre-line;
            font-family: var(--font-main);
            line-height: 1.7;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .question-text .ascii-table {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            background-color: var(--bg-main);
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
            margin-top: 1em;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .question-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 15px 0;
            display: block;
            box-shadow: 0 4px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            transition: border-color var(--transition-speed) ease, background-color var(--transition-speed) ease, transform 0.2s ease;
            font-size: 1rem;
            line-height: 1.5;
        }

        .option:hover {
            border-color: var(--primary-color);
            background-color: var(--primary-light-translucent, rgba(58, 134, 255, 0.1));
            transform: translateY(-2px);
        }
        .dark-mode .option:hover {
            background-color: rgba(124, 77, 255, 0.15);
        }

        .option input[type="radio"] {
            display: none;
        }

        .option-letter-styled {
            font-weight: 700;
            color: var(--primary-color);
            margin-right: 10px;
            line-height: 1.5; 
        }

        .option-actual-text {
            flex: 1;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .correct-answer, .explanation {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .correct-answer {
            color: var(--accent-color);
            font-weight: 600;
            background-color: var(--accent-light);
            border-left: 4px solid var(--accent-color);
            display: none;
        }

        .explanation {
            background-color: var(--bg-main);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            display: none;
        }

        .navigation {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }

        .nav-button, .action-button, .feedback-continue, .popup-button, .danger-button { 
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #ffffff;
            cursor: pointer;
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 1rem;
            transition: all var(--transition-speed) ease;
            width: 100%;
            text-align: center;
            box-shadow: 0 4px 10px var(--shadow-color);
            display: inline-flex; 
            align-items: center;
            justify-content: center;
        }
        .dark-mode .nav-button, .dark-mode .action-button, .dark-mode .feedback-continue, .dark-mode .popup-button, .dark-mode .danger-button {
            color: #ffffff;
        }

        .nav-button:hover, .action-button:hover, .feedback-continue:hover, .popup-button:hover, .danger-button:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 15px var(--shadow-color);
        }
        .danger-button {
            background: linear-gradient(135deg, var(--danger-color), #c0392b ); 
        }
        .danger-button:hover {
            background: linear-gradient(135deg, var(--danger-light), var(--danger-color));
        }
        .danger-button .icon, .action-button .icon { 
             margin-right: 8px;
        }
        
        .expand-button { 
            padding: 10px 18px;
            border: 1px solid var(--purple-accent); 
            border-radius: 8px;
            background: var(--text-secondary);
            color: var(--bg-card);
            cursor: pointer;
            font-family: var(--font-main);
            font-weight: 600;
            font-size: 0.9rem;
            transition: all var(--transition-speed) ease;
            width: auto; 
            display: inline-flex;
            align-items: center;
            margin: 0 auto 15px auto;
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        .dark-mode .expand-button {
            background: var(--text-secondary); 
            color: var(--bg-card);
            border: 1px solid var(--primary-light); 
        }
        .expand-button:hover {
            background: var(--primary-color);
            border-color: var(--primary-color); 
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }
        .expand-button .icon {
            margin-right: 8px;
            display: inline-block;
            transition: transform 0.3s ease;
        }
        .expand-button.expanded .icon {
            transform: rotate(180deg);
        }

        .nav-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: var(--border-color);
            color: var(--text-secondary);
            box-shadow: none;
        }

        .instant-feedback {
            padding: 12px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            display: none;
            font-size: 1rem;
            border-left-width: 6px;
            border-left-style: solid;
        }

        .instant-feedback.correct {
            background-color: var(--accent-light);
            color: var(--accent-color);
            border-left-color: var(--accent-color);
        }

        .instant-feedback.incorrect {
            background-color: var(--danger-light);
            color: var(--danger-color);
            border-left-color: var(--danger-color);
        }
        
        /* Estilos para o Popup de Congratulações (já presentes no seu CSS original) */
        .congrats-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.85); /* Fundo mais escuro para destaque */
            display: flex;
            flex-direction: column; /* Para alinhar o conteúdo verticalmente */
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Acima de outros popups */
            padding: 15px; /* Espaçamento para telas menores */
        }

        .congrats-content {
            background: var(--bg-card);
            padding: 30px; /* Mais padding interno */
            border-radius: var(--border-radius-main);
            max-width: 90%; /* Responsividade */
            width: 400px; /* Largura fixa para consistência */
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); /* Sombra mais pronunciada */
            border: 1px solid var(--primary-color); /* Borda temática */
        }

        .congrats-message {
            font-size: 1.4rem; /* Tamanho da fonte da mensagem */
            margin-bottom: 20px;
            color: var(--primary-color); /* Cor temática */
            font-weight: bold;
        }
        .random-iframe {
            margin: 20px 0; /* Espaçamento para o iframe */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .random-iframe iframe {
            border-radius: 8px; /* Bordas arredondadas para o iframe */
        }

        .close-popup-button { /* Reutilizando a classe para o botão de fechar */
            margin-top: 20px;
            padding: 10px 20px;
            background: var(--primary-color);
            color: #ffffff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color var(--transition-speed) ease;
        }
        .dark-mode .close-popup-button {
            color: #ffffff; /* Garante contraste no modo escuro */
        }
        .close-popup-button:hover {
            background: var(--primary-dark);
        }


        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
            padding: 20px;
        }
        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0s 0s;
        }
        .popup-content {
            background-color: var(--bg-card);
            padding: 25px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 10px 30px var(--shadow-color);
            width: 95%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            text-align: center;
            position: relative;
            border: 1px solid var(--border-color);
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        #questionDetailPopup .popup-content { 
            max-width: 700px; 
            text-align: left;
        }
        #questionDetailPopup .popup-close-button { 
            position: absolute; 
            top: 15px; 
            right: 15px; 
            background: transparent; 
            color: var(--text-secondary); 
            font-size: 1.75rem; 
            border: none; 
            padding: 5px;
            line-height: 1;
            cursor: pointer;
        }
        #questionDetailPopup .popup-close-button:hover {
             color: var(--primary-color);
             background: transparent; 
        }


        .popup-overlay.active .popup-content {
            transform: scale(1);
        }
        .popup-close-button { /* Estilo geral para botões de fechar popup, se não for o do congrats */
            margin-top: 20px;
            padding: 10px 20px;
            background-color: var(--text-secondary);
            color: var(--bg-card);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color var(--transition-speed) ease;
            width: auto;
            display: inline-block;
        }
        .dark-mode .popup-close-button {
            background-color: var(--border-color);
            color: var(--text-primary);
        }
        .popup-close-button:hover {
            background-color: var(--danger-color);
            color: white;
        }
        #quizOptionsPopupTitle {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.4rem;
        }
        #quizOptionsPopupSubtitle {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 1rem;
            font-weight: 500;
        }
        #quizOptionsPopupButtons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .feedback-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; 
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
            padding: 20px;
        }
        .feedback-popup.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0s 0s;
        }
        .feedback-content {
            background-color: var(--bg-card);
            padding: 30px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 10px 30px var(--shadow-color);
            width: 95%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            text-align: center;
            position: relative;
            border: 1px solid var(--border-color);
        }
        .feedback-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            line-height: 1;
        }
        .feedback-close:hover {
            color: var(--primary-color);
        }
        .feedback-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        .feedback-stats {
            margin: 12px 0;
            font-size: 1rem;
            color: var(--text-primary);
        }
        .feedback-stats span {
            font-weight: 600;
        }
        .feedback-correct {
            color: var(--accent-color);
        }
        .feedback-incorrect {
            color: var(--danger-color);
        }
        .feedback-percentage {
            font-size: 1.1rem;
            margin: 15px 0 25px 0;
            font-weight: 500;
            color: var(--text-primary);
        }
        #feedbackPercentageValue { 
            color: var(--primary-color);
            font-weight: 700;
            font-size: 1.6rem;
            margin-left: 8px;
        }
        #feedbackMistakesList {
            margin-top: 20px;
            max-height: 35vh;
            overflow-y: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
            text-align: left;
        }
        #feedbackMistakesList h4 {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-weight: 600;
        }
        .feedback-mistake-item {
            margin-bottom: 12px;
            padding: 12px;
            background-color: var(--bg-main);
            border-radius: 6px;
            border-left: 4px solid var(--danger-color);
            font-size: 0.9rem;
        }
        .dark-mode .feedback-mistake-item {
            background-color: rgba(255,255,255,0.03);
        }
        .feedback-mistake-question {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
        }
        .feedback-mistake-option {
            padding: 4px 0;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        .feedback-mistake-option.feedback-mistake-correct {
            color: var(--accent-color);
            border-left: none;
            background-color: transparent;
        }
        .feedback-mistake-option.feedback-mistake-selected {
            color: var(--danger-color);
            border-left: none;
            background-color: transparent;
        }
        .feedback-continue {
            margin-top: 30px;
        }

        .progress-container {
            width: 100%;
            background-color: var(--bg-main);
            border-radius: 8px;
            margin: 20px 0;
            height: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 0;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        #results-main-box {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 6px 20px var(--shadow-color);
            border-top: 5px solid transparent; 
            margin-top: 25px; 
            transition: border-color var(--transition-speed) ease;
        }
        .results-box-bad { border-top-color: var(--danger-color); }
        .results-box-average { border-top-color: var(--warning-color); }
        .results-box-good { border-top-color: var(--accent-color); }

        .stat-card {
            background: var(--bg-main); 
            color: var(--text-primary);
            border-radius: var(--border-radius-main);
            padding: 20px;
            box-shadow: 0 4px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            margin-bottom: 25px; 
        }
        .dark-mode .stat-card {
            background: var(--bg-card); 
        }
        .dark-mode .stat-card h3, .dark-mode .stat-card h4 {
            color: var(--primary-color); 
        }
        .stat-card h3, .stat-card h4 {
            text-align: center;
            margin-bottom: 15px;
        }

        #main-performance-card .chart-container {
            height: 280px; 
            max-height: 40vh; 
            position: relative; 
        }
        .stat-card .chart-container { 
            height: 200px; 
            position: relative;
        }
        .chart-container canvas { 
            width: 100% !important;
            height: 100% !important;
        }
        
        .final-score-container {
            text-align: center;
            margin-bottom: 20px; 
        }
        .final-score-label {
            display: block;
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .final-percentage { 
            text-align: center;
            margin-top: 10px; 
            margin-bottom: 25px; 
            color: var(--text-secondary);
            font-size: 1rem;
        }
        .final-percentage strong {
            color: var(--text-primary); 
            font-weight: 600;
        }
        .dark-mode .final-percentage strong {
            color: var(--text-primary);
        }

        .final-score-value-box {
            display: inline-block;
            padding: 15px 30px;
            border-radius: var(--border-radius-main);
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease, border-color var(--transition-speed) ease;
            border: 2px solid transparent;
            min-width: 150px;
        }
        .final-score-value-box.score-bad {
            background-color: var(--danger-light);
            color: var(--danger-color);
            border-color: var(--danger-color);
        }
        .final-score-value-box.score-average {
            background-color: var(--warning-light);
            color: var(--warning-color);
            border-color: var(--warning-color);
        }
        .final-score-value-box.score-good {
            background-color: var(--accent-light);
            color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .stats-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr; 
        }
         .stats-grid > .stat-card {
            margin-bottom: 0; 
        }
        .additional-stats, .questions-review {
            margin-top: 25px; 
        }

        .questions-review {
            text-align: center;
        }
        .analysis-content-box {
            background-color: var(--bg-main);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-main);
            padding: 20px;
            margin-top: 15px;
            text-align: left;
        }
        .dark-mode .analysis-content-box {
            background-color: rgba(0,0,0,0.1);
        }
        
        .analysis-correct-answer {
            margin-top: 15px;
            padding: 10px;
            background-color: var(--accent-light);
            border-radius: 6px;
            border-left: 4px solid var(--accent-color);
            color: var(--accent-color); 
            font-size: 0.95rem;
        }
        .dark-mode .analysis-correct-answer {
             background-color: rgba(0, 230, 118, 0.1);
        }
        .analysis-correct-answer strong {
            color: var(--accent-color); 
            font-weight: bold;
        }


        #resultsPage .actions {
            display: flex;
            flex-direction: column; 
            align-items: center; 
            gap: 15px;
            margin-top: 30px; 
            width: 100%;
        }
        #resultsPage .actions .action-button {
            width: 100%; 
            max-width: 300px; 
            flex-grow: 0;
        }

        .reset-stats-container { 
            text-align: center;
            margin-top: 25px; 
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
         #resetStatsBtn.small-reset-button { 
            font-size: 0.85rem;  
            padding: 8px 15px;   
            max-width: 280px;   
        }
        #resetStatsBtn { 
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        #resetStatsBtn:hover {
             background: linear-gradient(135deg, var(--danger-light), var(--danger-color));
        }
         #resetStatsBtn .icon {
            margin-right: 6px;
        }
        #resetStatsBtn:disabled {
            background: var(--border-color);
            opacity: 0.5;
            cursor: not-allowed;
        }


        @media (min-width: 768px) {
            .container { padding: 35px; }
            #main-performance-card .chart-container { height: 350px; }
            .stat-card .chart-container { height: 250px; } 
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .additional-charts { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
            .additional-charts .stat-card { margin-bottom: 0; }
            .final-score-value-box { padding: 20px 40px; font-size: 3rem; }
            
            #resultsPage .actions {
                 flex-direction: row;
                 justify-content: center; 
            }
             #resultsPage .actions .action-button {
                 width: auto; 
                 flex-basis: 220px; 
                 max-width: 250px;
            }
             #resetStatsBtn.small-reset-button { 
                 width: auto;
                 flex-basis: auto; 
                 max-width: 300px;
            }
        }
        @media (max-width: 600px) {
            #quizPage .header { flex-direction: column; align-items: center; }
            #quizPage .header h1#quizTitle { text-align: center; margin-bottom: 15px; }
            #quizPage .header .dark-mode-toggle { width: 100%; }
        }
        @media (max-width: 350px) {
            body { font-size: 14px; padding: 10px; }
            h1 { font-size: 1.3rem; }
            .question-container, .question-result { padding: 12px; }
            .option { padding: 10px; font-size: 0.95rem; }
            .nav-button, .action-button, .feedback-continue, .expand-button, .popup-button { padding: 10px; font-size: 0.95rem; }
            .final-score-value-box { font-size: 2rem; padding: 10px 20px;}
            #main-performance-card .chart-container { height: 250px; }
            .stat-card .chart-container { height: 180px; } 
            #resetStatsBtn.small-reset-button { font-size: 0.8rem; padding: 8px 12px; }
        }

    </style>
</head>
<body>
    <div class="container">
        <div id="quizPage" style="display:none;"> 
            <div class="header">
                <h1 id="quizTitle">Simulador de Provas</h1> 
                <button class="dark-mode-toggle" id="darkModeToggle">
                    <span class="icon-container">
                        <span class="moon-icon">🌙</span>
                        <span class="sun-icon">☀️</span>
                    </span>
                    <span id="darkModeText">Modo Escuro</span>
                </button>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="currentQuestion"></div>
            <div class="instant-feedback" id="instantFeedback"></div>
            <div class="navigation">
                <button onclick="previousQuestion()" id="prevBtn" class="nav-button" disabled>Anterior</button>
                <button onclick="nextQuestion()" id="nextBtn" class="nav-button">Próxima</button>
                <button onclick="finishTest()" id="finishBtn" class="nav-button" style="display: none;">Finalizar Prova</button>
            </div>
        </div>

        <div id="resultsPage" style="display: none;">
            <div class="header"> 
                <h1 id="resultsTitle">Resultados da Prova</h1>  
                <button class="dark-mode-toggle" id="darkModeToggleResults">
                     <span class="icon-container"> 
                        <span class="moon-icon">🌙</span>
                        <span class="sun-icon">☀️</span>
                    </span>
                    <span id="darkModeTextResults">Modo Escuro</span>
                </button>
            </div>

            <div id="results-main-box"> 
                <div class="results-header">
                    <div class="final-score-container">
                        <span class="final-score-label">Sua Nota Final:</span>
                        <div id="finalScoreText" class="final-score-value-box"></div>
                    </div>
                    <div class="final-percentage" id="finalPercentageText"></div>
                </div>

                <div class="stat-card" id="main-performance-card">
                    <h3>Desempenho Geral</h3>
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card" id="areasChartCard">
                        <h3>Acertos por Área</h3>
                        <div class="chart-container">
                            <canvas id="areasChart"></canvas>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Progresso nas Tentativas</h3>
                        <div class="chart-container">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                     <div class="stat-card">
                        <h3>Questões com Erros</h3>
                        <div class="chart-container">
                            <canvas id="mistakesChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="additional-stats stat-card"> 
                    <h3>Estatísticas Adicionais</h3>
                    <div class="additional-charts">
                        <div class="stat-card">
                            <h4 id="questionSizeChartTitle">Tamanho de Questão</h4>
                            <div class="chart-container">
                                <canvas id="questionSizeChart"></canvas> 
                            </div>
                        </div>
                        <div class="stat-card">
                            <h4>Tempo por Questão (Simulado)</h4>
                            <div class="chart-container">
                                <canvas id="timePerQuestionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="questions-review stat-card"> 
                    <h3>Análise Detalhada por Questão</h3>
                    <button class="expand-button" id="toggleAnalysisBtn">
                        <span class="icon">&#x25BC;</span>Expandir Análise
                    </button>
                    <div class="analysis-content-box" id="analysisBox" style="display: none;">
                        <div id="questionsAnalysis"></div>
                    </div>
                </div>

                <div class="actions">
                    <button onclick="startNewAttempt(false)" class="action-button">Nova Tentativa</button> <button onclick="startNewAttempt(true)" class="action-button">Revisar Erros</button> </div>
                <div class="reset-stats-container">
                    <button id="resetStatsBtn" class="action-button danger-button small-reset-button" disabled>
                        <span class="icon">🗑️</span> Resetar Progresso
                    </button>
                </div>
            </div> 
        </div>
    </div>

    <div class="feedback-popup" id="feedbackPopup">
        <div class="feedback-content">
            <button class="feedback-close" id="closeFeedback">×</button>
            <h3 class="feedback-title">Seu desempenho no bloco</h3>
            <div class="feedback-stats">
                Você respondeu <span id="feedbackTotal">0</span> questões neste bloco.
            </div>
            <div class="feedback-stats">
                <span class="feedback-correct">Acertos: <span id="feedbackCorrect">0</span></span> | 
                <span class="feedback-incorrect">Erros: <span id="feedbackIncorrect">0</span></span>
            </div>
            <div class="feedback-percentage">
                Taxa de acertos: <span id="feedbackPercentageValue">0</span>%
            </div>
            <div id="feedbackMistakesList"></div>
            <button class="feedback-continue" id="continueButton">Continuar</button>
        </div>
    </div>

    <div class="popup-overlay" id="quizStartOptionsPopup">
        <div class="popup-content">
            <h3 id="quizOptionsPopupTitle">Iniciar Simulado</h3>
            <p id="quizOptionsPopupSubtitle"></p>
            <div id="quizOptionsPopupButtons">
            </div>
            <button class="popup-close-button" onclick="closeQuizOptionsPopup()">Cancelar</button>
        </div>
    </div>
    
    <div class="popup-overlay" id="questionDetailPopup">
        <div class="popup-content" style="max-width: 700px; text-align: left;">
            <button class="popup-close-button" onclick="closeQuestionDetailPopup()" >×</button>
            <div id="questionDetailContent">
            </div>
        </div>
    </div>


    <script>
        // ID Fixo para o simulado embutido
        const EMBEDDED_QUIZ_ID = 'simulado_principal_embutido';
        let currentFileId = EMBEDDED_QUIZ_ID; // Usar o ID fixo globalmente

        // Chave para estatísticas no localStorage (mantida)
        const LOCAL_STORAGE_STATS_PREFIX = 'quizApp_stats_';

        // Questões embutidas diretamente no código
        const embeddedQuestionsSource = [
  {
    "enunciado": "Assinale a alternativa correta do mecanismo de intoxicação por monóxido de carbono.",
    "imagem": null,
    "alternativas": {
      "a": "Se liga a hemoglobina reduzindo a capacidade de transportar oxigênio para o cérebro, causando hipóxia cerebral.",
      "b": "Se liga a mioglobina reduzindo a capacidade de transportar oxigênio para o cérebro, causando hipóxia cerebral.",
      "c": "Ativa a maior produção de citocromo oxidase.",
      "d": "Se liga a hemoglobina produzindo um produto de alta afinidade, impedindo a chegada de oxigênio para o cérebro, causando hipóxia cerebral."
    },
    "correta": "a"
  },
  {
    "enunciado": "Os quadros de diarreias acontecem por diversos mecanismos diferentes. Assinale a alternativa correta de qual o tipo de diarreia é caracterizada por inflamação e lesão na mucosa intestinal, geralmente causada por infecções bacterianas ou virais.",
    "imagem": null,
    "alternativas": {
      "a": "Diarreia Osmótica.",
      "b": "Diarreia Secretora.",
      "c": "Diarreia Inflamatória.",
      "d": "Diarreia Motora."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa correta:",
    "imagem": null,
    "alternativas": {
      "a": "a linha alba representa uma depressão situada lateralmente ao músculo reto do abdome",
      "b": "a contração unilateral do m. oblíquo interno do abdome faz com que haja uma rotação contralateral e uma inclinação ipsilateral do tronco",
      "c": "o músculo transverso do abdome está situado num plano mais profundo em relação ao músculo oblíquo interno do abdome",
      "d": "a aponeurose do músculo oblíquo externo do abdome contribui para a formação das lâminas anterior e posterior da bainha do músculo reto do abdome acima da linha arqueada"
    },
    "correta": "c"
  },
  {
    "enunciado": "(Adaptada de Paiva Neto MA et col., 2001) Uma mulher de 59 anos apresentava dor latejante e contínua na hemiface esquerda (sobretudo no terço inferior) há seis meses que melhorava após o uso de Carbamazepina (medicamento para dor neuropática).  Além disso, apresentava fraqueza da musculatura da mastigação e hipoestesia (diminuição da sensibilidade) facial na área da mandíbula.  Após exame complementar (TC e RM) foi encontrada imagem sugestiva de tumor ocupando a fossa infratemporal entre os músculos pterigóideos e a asa maior do esfenoide.  Analisando os sinais e sintomas apresentados pela paciente e a localização topográfica do tumor é mais correto afirmar que:",
    "imagem": null,
    "alternativas": {
      "a": "O ramo oftálmico do trigêmeo, por isso a perda de sensibilidade facial.",
      "b": "O ramo maxilar do trigêmeo foi afetado junto ao forame redondo, por isso a hipoestesia facial.",
      "c": "O ramo mandibular do trigêmeo foi afetado junto ao forame oval, por isso os sintomas na área da mandíbula e a fraqueza dos músculos da mastigação.",
      "d": "O ramo mandibular do trigêmeo, situado na fossa infratemporal, foi comprimido após sair pelo forame estilomastóideo."
    },
    "correta": "c"
  },
  {
    "enunciado": "A irrigação da glândula tireoide é proporcionada pelas artérias:",
    "imagem": null,
    "alternativas": {
      "a": "tireóidea inferior, ramo da carótida comum e tireóidea superior, ramo da carótida externa.",
      "b": "tireóidea superior, ramo da carótida externa e tireóidea inferior, ramo do tronco tireocervical.",
      "c": "tireóidea superior, ramo da carótida interna e tireóidea inferior, ramo do tronco tireocervical.",
      "d": "tireóidea inferior, ramo do tronco braquiocefálico e tireóidea superior, ramo do tronco tireolinguofacial."
    },
    "correta": "b"
  },
  {
    "enunciado": "Em relação à formação da bainha do músculo reto do abdome, é mais correto afirmar que:",
    "imagem": null,
    "alternativas": {
      "a": "sua lâmina posterior, abaixo da linha arqueada, é constituída pela fáscia transversal",
      "b": "as diferenças ocorrem pela rotação da parte lombar da coluna vertebral durante o desenvolvimento",
      "c": "sua lâmina anterior, abaixo da linha arqueada, é constituída pelas aponeuroses dos músculos oblíquos externo e interno",
      "d": "sua lâmina posterior, acima da linha arqueada, é constituída pela aponeurose do músculo transverso do abdome"
    },
    "correta": "a"
  },
  {
    "enunciado": "Em relação à traqueia, assinale a alternativa incorreta:",
    "imagem": null,
    "alternativas": {
      "a": "bifurca-se nos brônquios principais direito e esquerdo;",
      "b": "é constituída por 16 a 20 anéis de cartilagem;",
      "c": "sua parte cervical, situa-se posteriormente ao esôfago;",
      "d": "a carina é a saliência externa formada pelo último anel traqueal;"
    },
    "correta": "d"
  },
  {
    "enunciado": "Uma mulher de 43 anos de idade sofre o efeito chicote em seu pescoço decorrente de uma colisão por trás em seu automóvel.  Nas semanas seguintes, recuperou-se do trauma e da dor em seu pescoço.  Três meses depois, comparece ao neurologista queixando-se de \"não consegue identificar direito o sabor de sua comida e não sente a ponta da lingua\".  Qual nervo provavelmente foi lesado?",
    "imagem": null,
    "alternativas": {
      "a": "alveolar inferior.",
      "b": "mandibular;",
      "c": "mentual;",
      "d": "lingual;"
    },
    "correta": "d"
  },
  {
    "enunciado": "Em relação à função dos músculos da parede abdominal, assinale a afirmação CORRETA:",
    "imagem": null,
    "alternativas": {
      "a": "os músculos de um lado determinam a inclinação do tronco para o lado oposto (flexão lateral).",
      "b": "durante a contração simultânea bilateral dos músculos oblíquos, eles auxiliam os músculos retos na extensão do tronco",
      "c": "o músculo oblíquos em contração unilateral auxiliam os músculos do dorso na rotação do tronco",
      "d": "embora inativos durante uma respiração calma, são os músculos mais importantes durante uma expiração forçada"
    },
    "correta": "d"
  },
  {
    "enunciado": "Na posição anatômica, o ponto mais baixo da cavidade pleural é o recesso:",
    "imagem": null,
    "alternativas": {
      "a": "retroesofágico.",
      "b": "costodiafragmático;",
      "c": "retroaortico;",
      "d": "costomediastinal;"
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a alternativa correta:",
    "imagem": null,
    "alternativas": {
      "a": "O pulmão direito possui 2 segmentos lingulares superior e inferior;",
      "b": "Cada pulmão está envolvido pela sua pleura parietal;",
      "c": "A pleura parietal divide-se em partes: diafragmática, mediastinal, costal e cúpula da pleura",
      "d": "No hilo pulmonar encontramos apenas os brônquios principais."
    },
    "correta": "c"
  },
  {
    "enunciado": "Um trabalhador procurou a departamento de medicina do trabalho queixando-se dos seguintes sintomas: > Dor abdominal; > Fadiga; >Cefaleia: >Alterações neurológicas.  O médico do trabalho disse que se tratava de uma intoxicação, e que ela estava com SATURNISMO.  Assinale a alternativa correta do metal causador da intoxicação.",
    "imagem": null,
    "alternativas": {
      "a": "Arsênico.",
      "b": "Mercúrio.",
      "c": "Chumbo.",
      "d": "Cádmio."
    },
    "correta": "c"
  },
  {
    "enunciado": "Sobre a glândula tireóide marque a incorreta:",
    "imagem": null,
    "alternativas": {
      "a": "É formado por 2 lobos e uma parte comunicando chamado de istmo",
      "b": "Tem forma de H localizada na parte anterior do pescoço ao nível de C5 a C7.",
      "c": "Tem rica rede de vascularização formado por 3 grandes troncos arteriais",
      "d": "É a maior glândula endócrina do corpo humano"
    },
    "correta": "d"
  },
  {
    "enunciado": "Assinale a alternativa correta do mecanismo de ação da acetilcolinesterase no sistema nervoso.",
    "imagem": null,
    "alternativas": {
      "a": "Inibir a liberação de acetilcolina nos terminais nervosos.",
      "b": "Estimular a liberação de acetilcolina nos receptores muscarínicos.",
      "c": "Romper a molécula de acetilcolina, interrompendo a transmissão sináptica.",
      "d": "Inibir a recaptação de acetilcolina pelos terminais nervosos."
    },
    "correta": "c"
  },
  {
    "enunciado": "O pontilhado basífílico, tem uma contribuição no diagnóstico de algumas patologias, inclusive nas contaminações por metais pesados.  Assinale a alternativa correta sobre a informação do aparecimento deste pontilhado em uma contaminação por metais:",
    "imagem": null,
    "alternativas": {
      "a": "Detecta a presença de chumbo no sangue.",
      "b": "É indicativo de um grau severo de anemia.",
      "c": "Determina a ligação da hemoglobina com o grupo 'M",
      "d": "Avalia a função renal."
    },
    "correta": "a"
  },
  {
    "enunciado": "João saiu para o almoço e precisava comer algo bem rápido.  Escolheu um frango, achou que estava mal cozido, mas não havia tempo para esperar e acabou comendo assim mesmo.  No dia seguinte, ele apresentou: .Diarreia aquosa com sangue e pus. Dor abdominal intensa. Febre alta (39 graus). Náuseas e vômitos.  Perda de apetite.  Considerando o histórico e os sintomas, assinale a alternativa do provável agente causador do quadro.",
    "imagem": null,
    "alternativas": {
      "a": "Escherichia coli (E. coli)",
      "b": "Salmonella enterica.",
      "c": "Shigella flexneri.",
      "d": "Campylobacter jejuni."
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a alternativa correta sobre o exame utilizado para avaliar a quantidade e identificar a contaminação por metais pesados.",
    "imagem": null,
    "alternativas": {
      "a": "Hemograma completo.",
      "b": "Exame de urina.",
      "c": "Dosagem de metais pesados no sangue e/ou urina pelo método qualitativo.",
      "d": "Dosagem de metais pesados no sangue e/ou urina pelo método de espectrometria."
    },
    "correta": "d"
  },
  {
    "enunciado": "O exame laboratorial de coprocultura, visa:",
    "imagem": null,
    "alternativas": {
      "a": "Detectar parasitas intestinais.",
      "b": "Diagnosticar doenças inflamatórias intestinais.",
      "c": "Identificar bactérias patogênicas no trato gastrointestinal.",
      "d": "Identificar vírus causadores de infecções gastrointestinais."
    },
    "correta": "c"
  },
  {
    "enunciado": "Um trabalhador de uma fábrica de lâmpadas, 40 anos, foi levado ao hospital após apresentar os seguintes sintomas: > Dor abdominal intensa.  > Náuseas e vômitos. > Diarreia sanguinolenta. > Fraqueza muscular. > Tremores.  Durante a anamnese ele relatou que antes destes sintomas ter manipulado \"líquido\" pesado e prateado no dia anterior sem EPI.  Baseado neste relato assinale a alternativa correta da contaminação.",
    "imagem": null,
    "alternativas": {
      "a": "Intoxicação aguda cianeto.",
      "b": "Intoxicação crônica por Arsênico.",
      "c": "Intoxicação aguda por mercúrio.",
      "d": "Intoxicação crônica por chumbo."
    },
    "correta": "c"
  },
  {
    "enunciado": "Qual o efeito mais comum no SNC, com o uso crônico de drogas estimulantes como cocaína e anfetaminas?",
    "imagem": null,
    "alternativas": {
      "a": "Deterioração cognitiva e alteração no humor.",
      "b": "Depressão respiratória.",
      "c": "Insuficiência renal aguda.",
      "d": "Lesão hepática."
    },
    "correta": "a"
  },
  {
    "enunciado": "Nos serviços de urgência e emergência deu entrada um paciente com tentativa de suicídio por overdose.  O médico solicitou uma amostra de urina para o teste de imunocromatografia por competição.  Assinale a alternativa correta sobre esta metodologia.",
    "imagem": null,
    "alternativas": {
      "a": "A droga/metabólito interage com o anticorpo conjugado e é capturado por um outro anticorpo imobilizado na região teste, o que apresentará cor na linha teste.",
      "b": "Imunoensaio por competição é aquele onde a droga ou os seus metabolitos de uma amostra de urina reagem com a droga fixada na região teste da membrana.",
      "c": "A droga ou seus metabólitos de uma amostra de urina competem com a droga fixada na membrana pelo anticorpo específico conjugado, o que não permitirá a ligação do anticorpo conjugado à droga fixada na região teste.",
      "d": "No teste de imunoocromatografia por competição, a droga ou seus metabólitos presentes na urina se ligam diretamente ao anticorpo imobilizado na região teste, formando um complexo colorido que indica um resultado positivo."
    },
    "correta": "c"
  },
  {
    "enunciado": "Em uma prova de farmacologia você recebeu as seguintes características sobre uma droga: Pode ser detectada após 3 a 4 horas de consumo.  É mantida no organismo por um período de 24 a 48 horas, após o último consumo.  É uma droga detectável no teste rápido.  Com base nestas característica, assinale a alternativa correta da droga de abuso em questão.",
    "imagem": null,
    "alternativas": {
      "a": "Cocaína.",
      "b": "Anfetaminas.",
      "c": "MDMA.",
      "d": "Ecstasy."
    },
    "correta": "b"
  },
  {
    "enunciado": "Individuo de 25 anos, foi levado ao pronto socorro pelos pais, foi encontrado desacordado dentro do carro ligado na garagem (ambiente fechado).  Considere que este indivíduo apresentou um quadro de intoxicação por monóxido de carbono.  Assinale a alternativa correta sobre os testes diagnósticos neste caso.",
    "imagem": null,
    "alternativas": {
      "a": "A forma de mensurar a carboxihemoglobina no plasma é pelo método de cooximetria, através da imunocromatografia.",
      "b": "Nos exames laboratoriais, fumantes geralmente apresentam níveis séricos plasmátiicos de carboxihemoglobina inferiores a 2%.",
      "c": "Nos exames laboratoriais, não fumantes geralmente apresentam níveis séricos plasmátiicos de carboxihemoglobina iguais a 5%.",
      "d": "Não será realizado a monitoração de oxigênio por oximetria de pulso, pois este tipo de dosagem não diferencia a carboxihemoglobina da oxihemoglobina no plasma."
    },
    "correta": "d"
  },
  {
    "enunciado": "Coma e convulsões intermitentes são sintomas que aparecem após intoxicação por monóxido de carbono.  Assinale a alternativa correta do percentua de COHb, que estes sintomas aparecem.",
    "imagem": null,
    "alternativas": {
      "a": "50%-60%.",
      "b": "30%-40%.",
      "c": "20%-30%.",
      "d": "10%-20%."
    },
    "correta": "a"
  },
  {
    "enunciado": "Assinale a alternativa que melhor indique um fator associado ao estilo de vida responsável por aumentar os níveis de carboxihemoglobina humana.",
    "imagem": null,
    "alternativas": {
      "a": "Tabagismo crônico.",
      "b": "Ingestão de embutidos.",
      "c": "Uso de odorizantes automotivos.",
      "d": "Uso de inseticida aerosol."
    },
    "correta": "a"
  },
  {
    "enunciado": "O chumbinho é responsável por muitas mortes de animais, crianças e adultos por envenenamento acidental ou tentativa de suicídio.  Assinale a alternativa correta que explica a fisiopatologia deste envenenamento.",
    "imagem": null,
    "alternativas": {
      "a": "O envenenamento ocorre pela ação do chumbinho classificado como organoclorado, sua ação é inibir a enzima acetilcolinesterase na fenda sináptica aumentando a quantidade de acetilcolina.",
      "b": "O envenenamento ocorre pela ação do chumbinho classificado como organofosforado, sua ação é inibir a enzima acetilcolinesterase na fenda sináptica diminuindo a quantidade de acetilcolina.",
      "c": "O envenenamento ocorre pela ação do chumbinho classificado como carbamato e sua ação é inibir a enzima acetilcolinesterase na fenda sináptica aumentando a quantidade de acetilcolina.",
      "d": "O envenenamento ocorre pela ação do chumbinho, classificado como carbamato, sua ação é inibir a enzima acetilcolinesterase na fenda sináptica diminuindo a quantidade de acetilcolina."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa do receptor que está envolvido no efeito de recompensa e dependência associado ao uso de drogas estimulantes.",
    "imagem": null,
    "alternativas": {
      "a": "Receptor de dopamina D1.",
      "b": "Receptor de serotonina 5-HT2A.",
      "c": "Receptor GABA-A",
      "d": "Receptor de opioides."
    },
    "correta": "a"
  },
  {
    "enunciado": "Laboratorialmente podemos pedir a dosagem de colinesterase plasmática e eritrocitária.  Assinale a alternativa que melhor explica a diferença entre as dosagens.",
    "imagem": null,
    "alternativas": {
      "a": "A plasmática indica a absorção do organoclorado em uma contaminação aguda, enquanto a eritrocitária indica o efeito tóxico de uma contaminação crônica.",
      "b": "A plasmática indica a absorção do organofosforado em uma contaminação aguda, enquanto a eritrocitária indica o efeito tóxico de uma contaminação crônica.",
      "c": "A plasmática indica a absorção do organofosforado em uma contaminação crônica, enquanto a eritrocitária indica o efeito tóxico de uma contaminação aguda.",
      "d": "A plasmática indica a absorção do organoclorado em uma contaminação crônica enquanto a eritrocitária indican (texto incompleto na fonte)"
    },
    "correta": "b"
  },
  {
    "enunciado": "Uma mulher de 60 anos de idade apresentou uma tosse não produtiva por 4 meses junto à perda do apetite e emagrecimento ponderal de 6 kg.  Ela não fuma.  Ao exame físico, não são encontrados achados importantes.  Sua radiografia de tórax revela a presença de massa subpleural periférica direita.  Uma biópsia de aspiração por agulha fina é realizada, e ela é submetida a uma lobectomia inferior direita.  O aspecto microscópico da lesão é exibido na figura. De qual das seguintes neoplasias ela mais provavelmente era portadora?",
    "imagem": "https://i.imgur.com/whLhtYm.png",
    "alternativas": {
      "a": "Adenocarcinoma bronquioloalveolar.",
      "b": "Carcinoma de células escamosas bem diferenciado.",
      "c": "Carcinoma de células pequenas.",
      "d": "Adenocarcinoma."
    },
    "correta": "d"
  },
  {
    "enunciado": "As imagens abaixo representam macroscopicamente tumores malignos pulmonares. Sobre esses tumores, assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/JjKePlM.png",
    "alternativas": {
      "a": "A tem alta probabilidade de representar um câncer de pulmão associado a síndrome paraneoplásica.",
      "b": "B tem alta probabilidade de representar um câncer de pulmão associado a uma história de tabagismo.",
      "c": "B é sugestiva de um adenocarcinoma.",
      "d": "A é sugestiva de um carcinoma."
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a alternativa correta sobre o que diferencia diarreia crônica da aguda.",
    "imagem": null,
    "alternativas": {
      "a": "Causa bacteriana ou viral.",
      "b": "Diarreia crônica apresenta sangue e pus.",
      "c": "Diarreia crônica dura menos de 2 semanas.",
      "d": "Diarreia crônica dura mais de 2 semanas."
    },
    "correta": "d"
  },
  {
    "enunciado": "Sobre as enterocolites parasitárias: I. A criptosporidiose é caracterizada como uma doença gastrentérica decorrente de um protozoário parasita extracelular observado na imagem A.  II. A imagem B revela Ascaris, um verme redondo cuja a doença é causada quando as suas larvas migram da circulação esplâncnica para a circulação sistêmica e criam um abscesso hepático ou pneumonite do Ascaris.  III. A imagem C revela enterite infecciosa por Giardia lamblia presentes no espaço luminal; seu formato facilita a ligação aos enterócitos vilosos da borda em escova, gerando apoptose das células epiteliais.  IV. A imagem D revela processo inflamatório eosinofílico patognomônico do parasita exibido na imagem B.  Assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/k9I8RiQ.png",
    "alternativas": {
      "a": "II e III estão corretas.",
      "b": "I e IV estão corretas.",
      "c": "III e IV estão corretas.",
      "d": "I e II estão corretas."
    },
    "correta": "a"
  },
  {
    "enunciado": "Observe as imagens referentes a fragmentos de tireoide. Assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/QYhbMhw.png",
    "alternativas": {
      "a": "A imagem D sugere paciente apresentando níveis séricos elevados de TSH.",
      "b": "Na imagem B os folículos distendidos tem alta captação de iodo radioativo.",
      "c": "Os folículos tireoidianos da imagem C podem ser encontrados em tireoides de pacientes com hipotireoidismo devido ao excesso de halógenos no organismo, bem como carência de iodo na dieta.",
      "d": "A imagem A é compatível com o estágio hiperplásico do bócio difuso atóxico."
    },
    "correta": "a"
  },
  {
    "enunciado": "Um homem de 65 anos de idade trabalhou em um estaleiro por 10 anos e depois trabalhou por 5 para uma empresa que instalava isolamento retardante de fogo.  Ele sofreu de dispneia progressiva por vários anos e, por fim, morreu devido a uma insuficiência respiratória progressiva com hipoxemia.  Na necropsia, detectou a presença de massa rígida, de cor acastanhada, que envolvia o pulmão esquerdo, sugestiva de provavelmente um mesotelioma maligno.  Qual dos seguintes achados mais provavelmente foi observado no parênquima pulmonar desse paciente?",
    "imagem": "https://i.imgur.com/Gx3Wzan.png",
    "alternativas": {
      "a": "Achado da Imagem B",
      "b": "Achado da Imagem C",
      "c": "Achado da Imagem D",
      "d": "Achado da Imagem A"
    },
    "correta": "a"
  },
  {
    "enunciado": "Um dia após comer mariscos crus ou pouco cozidos, uma mulher saudável desenvolveu uma diarreia aquosa profusa/volumosa.  No exame físico, sua temperatura era de 37,50C. O resultado da amostra fecal foi negativo para sangue oculto.  Não havia distensão abdominal ou sensibilidade, e os sons intestinais estavam presentes. A diarreia permanecera por 3 dias.  Qual dos seguintes organismos mais provavelmente está envolvido na produção de tais achados?",
    "imagem": null,
    "alternativas": {
      "a": "Vibrio cholerae.",
      "b": "Ascaris lumbricoides.",
      "c": "Giardia Lamblia.",
      "d": "Cryptosporidium."
    },
    "correta": "a"
  },
  {
    "enunciado": "Um homem de 45 anos de idade fumava dois maços de cigarros por dia, durante 20 anos.  Há 5 anos, ele vem sofrendo de uma tosse crônica com copiosa expectoração mucosa.  Durante o último ano, ele manifestou vários episódios de infecções do trato respiratório.  A radiografia do tórax revela uma silhueta cardíaca direita proeminente.  Qual das seguintes condições patológicas descreve melhor tais achados clínicos?",
    "imagem": null,
    "alternativas": {
      "a": "Enfisema predominante.",
      "b": "Bronquite crônica predominante.",
      "c": "Bronquite crônica com Cor pulmonale.",
      "d": "Bronquite crônica com enfisema."
    },
    "correta": "c"
  },
  {
    "enunciado": "Moléculas de alto peso molecular, contendo halogênios e/ou anéis aromáticos condensados, como é o caso dos agrotóxicos organoclorados, quando em excesso no organismo podem gerar na tireoide:",
    "imagem": "https://i.imgur.com/ZfYDVsl.png",
    "alternativas": {
      "a": "Bloqueio da molécula que transporta o iodo chamada pendrina.",
      "b": "Inibição na adição de carboidrato à proteína tirosina no interior das cisternas do retículo e no complexo de Golgi das células foliculares.",
      "c": "Um aumento de tamanho, ou seja, bócio, que inicialmente pode ser representado microscopicamente pela imagem.",
      "d": "Queda na síntese de T3 e T4, induzindo aumento de TSH, o que provoca hipertrofia e hiperplasia das células foliculares na tentativa de manter o estado metabólico eutireoideo."
    },
    "correta": "d"
  },
  {
    "enunciado": "Um homem de 50 anos de idade vem ao médico com dispneia de agravamento gradual e uma perda ponderal de 4 kg ao longo dos últimos 2 anos.  Não relata tosse produtiva. Ele admite que, durante 20 anos, fumava 2 maços de cigarros por dia, mas afirma que não fumou no último ano.  O exame físico revela um aumento do diâmetro anteroposterior do tórax (\"tórax em barril\").  A ausculta do tórax aponta redução dos sons pulmonares.  A radiografia de tórax exibe pulmões hipertransparentes bilaterais; a transparência está especialmente acentuada nos lobos superiores.  Os testes de função pulmonar mostram que a razão entre volume expiratório forçado no primeiro segundo e a capacidade vital está diminuída.  Entre as opções seguintes, assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/ukbuDg6.png",
    "alternativas": {
      "a": "Os achados do paciente são predominantemente os de uma doença pulmonar obstrutiva caracterizada pela imagem B.",
      "b": "O hábito de fumar do paciente pode desencadear um aumento da produção de elastase pelos neutrófilos e macrófagos, resultando na perda do retrocesso elástico.",
      "c": "Há uma elevada probabilidade do paciente apresentar a alteração cardíaca indicada pela imagem A.",
      "d": "A patogênese da doença descrita envolve o comprometimento da liberação hepática de a1-antitripsina."
    },
    "correta": "b"
  },
  {
    "enunciado": "Várias crianças de 3 a 6 anos de idade foram admitidas a um hospital local em virtude de crise encefalopática.  Elas moram na mesma comunidade desde que nasceram. Todas já haviam exibido anteriormente retardo no desenvolvimento psicomotor.  Ao exame físico, as crianças apresentavam dor abdominal difusa e sofriam de náuseas e vômitos.  Varreduras de TC do crânio apontam edema cerebral marcante. Estudos laboratoriais mostram anemia microcítica.  Um pesquisador enviado à comunidade em que as crianças moravam encontra um conjunto de apartamentos decadentes com vazamentos graves, encanamento deficiente, falta de ventilação e pintura descascada.  A exposição tóxica a qual das seguintes substâncias responde melhor por tais achados?",
    "imagem": null,
    "alternativas": {
      "a": "Mercúrio.",
      "b": "Arsênico.",
      "c": "Chumbo.",
      "d": "DDT"
    },
    "correta": "c"
  },
  {
    "enunciado": "Um agricultor de 35 anos é admitido no hospital com sintomas de intoxicação por pesticida.  Qual exame você solicitaria para confirmar a intoxicação por carbamato?",
    "imagem": null,
    "alternativas": {
      "a": "Dosagem de acetilcolinesterase (AChE) no sangue.",
      "b": "Dosagem de carbamato no sangue.",
      "c": "Análise da urina para detectar metabólitos de carbamato.",
      "d": "Hemograma completo."
    },
    "correta": "a"
  },
  {
    "enunciado": "Assinale a alternativa correta do mecanismo de intoxicação por monóxido de carbono.",
    "imagem": null,
    "alternativas": {
      "a": "Se liga a hemoglobina reduzindo a capacidade de transportar oxigênio para o cérebro, causando hipóxia cerebral.",
      "b": "Se liga a mioglobina reduzindo a capacidade de transportar oxigênio para o cérebro, causando hipóxia cerebral.",
      "c": "Ativa a maior produção de citocromo oxidase.",
      "d": "Se liga a hemoglobina produzindo um produto de alta afinidade, impedindo a chegada de oxigênio para o cérebro, causando hipóxia cerebral."
    },
    "correta": "a"
  },
  {
    "enunciado": "Os quadros de diarreias acontecem por diversos mecanismos diferentes. Assinale a alternativa correta de qual o tipo de diarreia é caracterizada por inflamação e lesão na mucosa intestinal, geralmente causada por infecções bacterianas ou virais.",
    "imagem": null,
    "alternativas": {
      "a": "Diarreia Osmótica.",
      "b": "Diarreia Secretora.",
      "c": "Diarreia Inflamatória.",
      "d": "Diarreia Motora."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa correta:",
    "imagem": null,
    "alternativas": {
      "a": "a linha alba representa uma depressão situada lateralmente ao músculo reto do abdome",
      "b": "a contração unilateral do m. oblíquo interno do abdome faz com que haja uma rotação contralateral e uma inclinação ipsilateral do tronco",
      "c": "o músculo transverso do abdome está situado num plano mais profundo em relação ao músculo oblíquo interno do abdome",
      "d": "a aponeurose do músculo oblíquo externo do abdome contribui para a formação das lâminas anterior e posterior da bainha do músculo reto do abdome acima da linha arqueada"
    },
    "correta": "c"
  },
  {
    "enunciado": "(Adaptada de Paiva Neto MA et col., 2001) Uma mulher de 59 anos apresentava dor latejante e contínua na hemiface esquerda (sobretudo no terço inferior) há seis meses que melhorava após o uso de Carbamazepina (medicamento para dor neuropática).  Além disso, apresentava fraqueza da musculatura da mastigação e hipoestesia (diminuição da sensibilidade) facial na área da mandíbula.  Após exame complementar (TC e RM) foi encontrada imagem sugestiva de tumor ocupando a fossa infratemporal entre os músculos pterigóideos e a asa maior do esfenoide.  Analisando os sinais e sintomas apresentados pela paciente e a localização topográfica do tumor é mais correto afirmar que:",
    "imagem": null,
    "alternativas": {
      "a": "O ramo oftálmico do trigêmeo, por isso a perda de sensibilidade facial.",
      "b": "O ramo maxilar do trigêmeo foi afetado junto ao forame redondo, por isso a hipoestesia facial.",
      "c": "O ramo mandibular do trigêmeo foi afetado junto ao forame oval, por isso os sintomas na área da mandíbula e a fraqueza dos músculos da mastigação.",
      "d": "O ramo mandibular do trigêmeo, situado na fossa infratemporal, foi comprimido após sair pelo forame estilomastóideo."
    },
    "correta": "c"
  },
  {
    "enunciado": "A irrigação da glândula tireoide é proporcionada pelas artérias:",
    "imagem": null,
    "alternativas": {
      "a": "tireóidea inferior, ramo da carótida comum e tireóidea superior, ramo da carótida externa.",
      "b": "tireóidea superior, ramo da carótida externa e tireóidea inferior, ramo do tronco tireocervical.",
      "c": "tireóidea superior, ramo da carótida interna e tireóidea inferior, ramo do tronco tireocervical.",
      "d": "tireóidea inferior, ramo do tronco braquiocefálico e tireóidea superior, ramo do tronco tireolinguofacial."
    },
    "correta": "b"
  },
  {
    "enunciado": "Em relação à formação da bainha do músculo reto do abdome, é mais correto afirmar que:",
    "imagem": null,
    "alternativas": {
      "a": "sua lâmina posterior, abaixo da linha arqueada, é constituída pela fáscia transversal",
      "b": "as diferenças ocorrem pela rotação da parte lombar da coluna vertebral durante o desenvolvimento",
      "c": "sua lâmina anterior, abaixo da linha arqueada, é constituída pelas aponeuroses dos músculos oblíquos externo e interno",
      "d": "sua lâmina posterior, acima da linha arqueada, é constituída pela aponeurose do músculo transverso do abdome"
    },
    "correta": "a"
  },
  {
    "enunciado": "Em relação à traqueia, assinale a alternativa incorreta:",
    "imagem": null,
    "alternativas": {
      "a": "bifurca-se nos brônquios principais direito e esquerdo;",
      "b": "é constituída por 16 a 20 anéis de cartilagem;",
      "c": "sua parte cervical, situa-se posteriormente ao esôfago;",
      "d": "a carina é a saliência externa formada pelo último anel traqueal;"
    },
    "correta": "c"
  },
  {
    "enunciado": "Uma mulher de 43 anos de idade sofre o efeito chicote em seu pescoço decorrente de uma colisão por trás em seu automóvel.  Nas semanas seguintes, recuperou-se do trauma e da dor em seu pescoço.  Três meses depois, comparece ao neurologista queixando-se de \"não consegue identificar direito o sabor de sua comida e não sente a ponta da lingua\".  Qual nervo provavelmente foi lesado?",
    "imagem": null,
    "alternativas": {
      "a": "alveolar inferior.",
      "b": "mandibular;",
      "c": "mentual;",
      "d": "lingual;"
    },
    "correta": "d"
  },
  {
    "enunciado": "Em relação à função dos músculos da parede abdominal, assinale a afirmação CORRETA:",
    "imagem": null,
    "alternativas": {
      "a": "os músculos de um lado determinam a inclinação do tronco para o lado oposto (flexão lateral).",
      "b": "durante a contração simultânea bilateral dos músculos oblíquos, eles auxiliam os músculos retos na extensão do tronco",
      "c": "o músculo oblíquos em contração unilateral auxiliam os músculos do dorso na rotação do tronco",
      "d": "embora inativos durante uma respiração calma, são os músculos mais importantes durante uma expiração forçada"
    },
    "correta": "d"
  },
  {
    "enunciado": "Na posição anatômica, o ponto mais baixo da cavidade pleural é o recesso:",
    "imagem": null,
    "alternativas": {
      "a": "retroesofágico.",
      "b": "costodiafragmático;",
      "c": "retroaortico;",
      "d": "costomediastinal;"
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a alternativa correta:",
    "imagem": null,
    "alternativas": {
      "a": "O pulmão direito possui 2 segmentos lingulares superior e inferior;",
      "b": "Cada pulmão está envolvido pela sua pleura parietal;",
      "c": "A pleura parietal divide-se em partes: diafragmática, mediastinal, costal e cúpula da pleura",
      "d": "No hilo pulmonar encontramos apenas os brônquios principais."
    },
    "correta": "c"
  },
  {
    "enunciado": "Um trabalhador procurou a departamento de medicina do trabalho queixando-se dos seguintes sintomas: > Dor abdominal; > Fadiga; >Cefaleia: >Alterações neurológicas.  O médico do trabalho disse que se tratava de uma intoxicação, e que ela estava com SATURNISMO.  Assinale a alternativa correta do metal causador da intoxicação.",
    "imagem": null,
    "alternativas": {
      "a": "Arsênico.",
      "b": "Mercúrio.",
      "c": "Chumbo.",
      "d": "Cádmio."
    },
    "correta": "c"
  },
  {
    "enunciado": "Sobre a glândula tireóide marque a incorreta:",
    "imagem": null,
    "alternativas": {
      "a": "É formado por 2 lobos e uma parte comunicando chamado de istmo",
      "b": "Tem forma de H localizada na parte anterior do pescoço ao nível de C5 a C7.",
      "c": "Tem rica rede de vascularização formado por 3 grandes troncos arteriais",
      "d": "É a maior glândula endócrina do corpo humano"
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa correta do mecanismo de ação da acetilcolinesterase no sistema nervoso.",
    "imagem": null,
    "alternativas": {
      "a": "Inibir a liberação de acetilcolina nos terminais nervosos.",
      "b": "Estimular a liberação de acetilcolina nos receptores muscarínicos.",
      "c": "Romper a molécula de acetilcolina, interrompendo a transmissão sináptica.",
      "d": "Inibir a recaptação de acetilcolina pelos terminais nervosos."
    },
    "correta": "c"
  },
  {
    "enunciado": "O pontilhado basífílico, tem uma contribuição no diagnóstico de algumas patologias, inclusive nas contaminações por metais pesados.  Assinale a alternativa correta sobre a informação do aparecimento deste pontilhado em uma contaminação por metais:",
    "imagem": null,
    "alternativas": {
      "a": "Detecta a presença de chumbo no sangue.",
      "b": "É indicativo de um grau severo de anemia.",
      "c": "Determina a ligação da hemoglobina com o grupo 'M",
      "d": "Avalia a função renal."
    },
    "correta": "a"
  },
  {
    "enunciado": "João saiu para o almoço e precisava comer algo bem rápido.  Escolheu um frango, achou que estava mal cozido, mas não havia tempo para esperar e acabou comendo assim mesmo.  No dia seguinte, ele apresentou: .Diarreia aquosa com sangue e pus. Dor abdominal intensa. Febre alta (39 graus). Náuseas e vômitos.  Perda de apetite.  Considerando o histórico e os sintomas, assinale a alternativa do provável agente causador do quadro.",
    "imagem": null,
    "alternativas": {
      "a": "Escherichia coli (E. coli)",
      "b": "Salmonella enterica.",
      "c": "Shigella flexneri.",
      "d": "Campylobacter jejuni."
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a alternativa correta sobre o exame utilizado para avaliar a quantidade e identificar a contaminação por metais pesados.",
    "imagem": null,
    "alternativas": {
      "a": "Hemograma completo.",
      "b": "Exame de urina.",
      "c": "Dosagem de metais pesados no sangue e/ou urina pelo método qualitativo.",
      "d": "Dosagem de metais pesados no sangue e/ou urina pelo método de espectrometria."
    },
    "correta": "d"
  },
  {
    "enunciado": "O exame laboratorial de coprocultura, visa:",
    "imagem": null,
    "alternativas": {
      "a": "Detectar parasitas intestinais.",
      "b": "Diagnosticar doenças inflamatórias intestinais.",
      "c": "Identificar bactérias patogênicas no trato gastrointestinal.",
      "d": "Identificar vírus causadores de infecções gastrointestinais."
    },
    "correta": "c"
  },
  {
    "enunciado": "Um trabalhador de uma fábrica de lâmpadas, 40 anos, foi levado ao hospital após apresentar os seguintes sintomas: > Dor abdominal intensa.  > Náuseas e vômitos. > Diarreia sanguinolenta. > Fraqueza muscular. > Tremores.  Durante a anamnese ele relatou que antes destes sintomas ter manipulado \"líquido\" pesado e prateado no dia anterior sem EPI.  Baseado neste relato assinale a alternativa correta da contaminação.",
    "imagem": null,
    "alternativas": {
      "a": "Intoxicação aguda cianeto.",
      "b": "Intoxicação crônica por Arsênico.",
      "c": "Intoxicação aguda por mercúrio.",
      "d": "Intoxicação crônica por chumbo."
    },
    "correta": "c"
  },
  {
    "enunciado": "Qual o efeito mais comum no SNC, com o uso crônico de drogas estimulantes como cocaína e anfetaminas?",
    "imagem": null,
    "alternativas": {
      "a": "Deterioração cognitiva e alteração no humor.",
      "b": "Depressão respiratória.",
      "c": "Insuficiência renal aguda.",
      "d": "Lesão hepática."
    },
    "correta": "a"
  },
  {
    "enunciado": "Nos serviços de urgência e emergência deu entrada um paciente com tentativa de suicídio por overdose.  O médico solicitou uma amostra de urina para o teste de imunocromatografia por competição.  Assinale a alternativa correta sobre esta metodologia.",
    "imagem": null,
    "alternativas": {
      "a": "A droga/metabólito interage com o anticorpo conjugado e é capturado por um outro anticorpo imobilizado na região teste, o que apresentará cor na linha teste.",
      "b": "Imunoensaio por competição é aquele onde a droga ou os seus metabolitos de uma amostra de urina reagem com a droga fixada na região teste da membrana.",
      "c": "A droga ou seus metabólitos de uma amostra de urina competem com a droga fixada na membrana pelo anticorpo específico conjugado, o que não permitirá a ligação do anticorpo conjugado à droga fixada na região teste.",
      "d": "No teste de imunocromatografia por competição, a linha teste só apresentará coloração se a amostra de urina contiver altas concentrações da droga, pois quanto maior a quantidade do analito, mais intensa será a reação com o anticorpo conjugado."
    },
    "correta": "c"
  },
  {
    "enunciado": "Em uma prova de farmacologia você recebeu as seguintes características sobre uma droga: Pode ser detectada após 3 a 4 horas de consumo.  É mantida no organismo por um período de 24 a 48 horas, após o último consumo.  É uma droga detectável no teste rápido.  Com base nestas característica, assinale a alternativa correta da droga de abuso em questão.",
    "imagem": null,
    "alternativas": {
      "a": "Cocaína.",
      "b": "Anfetaminas.",
      "c": "MDMA.",
      "d": "Ecstasy."
    },
    "correta": "b"
  },
  {
    "enunciado": "Individuo de 25 anos, foi levado ao pronto socorro pelos pais, foi encontrado desacordado dentro do carro ligado na garagem (ambiente fechado).  Considere que este indivíduo apresentou um quadro de intoxicação por monóxido de carbono.  Assinale a alternativa correta sobre os testes diagnósticos neste caso.",
    "imagem": null,
    "alternativas": {
      "a": "A forma de mensurar a carboxihemoglobina no plasma é pelo método de cooximetria, através da imunocromatografia.",
      "b": "Nos exames laboratoriais, fumantes geralmente apresentam níveis séricos plasmátiicos de carboxihemoglobina inferiores a 2%.",
      "c": "Nos exames laboratoriais, não fumantes geralmente apresentam níveis séricos plasmátiicos de carboxihemoglobina iguais a 5%.",
      "d": "Não será realizado a monitoração de oxigênio por oximetria de pulso, pois este tipo de dosagem não diferencia a carboxihemoglobina da oxihemoglobina no plasma."
    },
    "correta": "d"
  },
  {
    "enunciado": "Coma e convulsões intermitentes são sintomas que aparecem após intoxicação por monóxido de carbono.  Assinale a alternativa correta do percentua de COHb, que estes sintomas aparecem.",
    "imagem": null,
    "alternativas": {
      "a": "50%-60%.",
      "b": "30%-40%.",
      "c": "20%-30%.",
      "d": "10%-20%."
    },
    "correta": "a"
  },
  {
    "enunciado": "Assinale a alternativa que melhor indique um fator associado ao estilo de vida responsável por aumentar os níveis de carboxihemoglobina humana.",
    "imagem": null,
    "alternativas": {
      "a": "Tabagismo crônico.",
      "b": "Ingestão de embutidos.",
      "c": "Uso de odorizantes automotivos.",
      "d": "Uso de inseticida aerosol."
    },
    "correta": "a"
  },
  {
    "enunciado": "O chumbinho é responsável por muitas mortes de animais, crianças e adultos por envenenamento acidental ou tentativa de suicídio.  Assinale a alternativa correta que explica a fisiopatologia deste envenenamento.",
    "imagem": null,
    "alternativas": {
      "a": "O envenenamento ocorre pela ação do chumbinho classificado como organoclorado, sua ação é inibir a enzima acetilcolinesterase na fenda sináptica aumentando a quantidade de acetilcolina.",
      "b": "O envenenamento ocorre pela ação do chumbinho classificado como organofosforado, sua ação é inibir a enzima acetilcolinesterase na fenda sináptica diminuindo a quantidade de acetilcolina.",
      "c": "O envenenamento ocorre pela ação do chumbinho classificado como carbamato e sua ação é inibir a enzima acetilcolinesterase na fenda sináptica aumentando a quantidade de acetilcolina.",
      "d": "O envenenamento ocorre pela ação do chumbinho, classificado como carbamato, sua ação é inibir a enzima acetilcolinesterase na fenda sináptica diminuindo a quantidade de acetilcolina."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa do receptor que está envolvido no efeito de recompensa e dependência associado ao uso de drogas estimulantes.",
    "imagem": null,
    "alternativas": {
      "a": "Receptor de dopamina D1.",
      "b": "Receptor de serotonina 5-HT2A.",
      "c": "Receptor GABA-A",
      "d": "Receptor de opioides."
    },
    "correta": "a"
  },
  {
    "enunciado": "Laboratorialmente podemos pedir a dosagem de colinesterase plasmática e eritrocitária.  Assinale a alternativa que melhor explica a diferença entre as dosagens.",
    "imagem": null,
    "alternativas": {
      "a": "A plasmática indica a absorção do organoclorado em uma contaminação aguda, enquanto a eritrocitária indica o efeito tóxico de uma contaminação crônica.",
      "b": "A plasmática indica a absorção do organofosforado em uma contaminação aguda, enquanto a eritrocitária indica o efeito tóxico de uma contaminação crônica.",
      "c": "A plasmática indica a absorção do organofosforado em uma contaminação crônica, enquanto a eritrocitária indica o efeito tóxico de uma contaminação aguda.",
      "d": "A plasmática indica a absorção do organoclorado em uma contaminação crônica enquanto a eritrocitária indican (texto incompleto na fonte)"
    },
    "correta": "b"
  },
  {
    "enunciado": "Uma mulher de 60 anos de idade apresentou uma tosse não produtiva por 4 meses junto à perda do apetite e emagrecimento ponderal de 6 kg.  Ela não fuma.  Ao exame físico, não são encontrados achados importantes.  Sua radiografia de tórax revela a presença de massa subpleural periférica direita.  Uma biópsia de aspiração por agulha fina é realizada, e ela é submetida a uma lobectomia inferior direita.  O aspecto microscópico da lesão é exibido na figura. De qual das seguintes neoplasias ela mais provavelmente era portadora?",
    "imagem": "https://i.imgur.com/whLhtYm.png",
    "alternativas": {
      "a": "Adenocarcinoma bronquioloalveolar.",
      "b": "Carcinoma de células escamosas bem diferenciado.",
      "c": "Carcinoma de células pequenas.",
      "d": "Adenocarcinoma."
    },
    "correta": "d"
  },
  {
    "enunciado": "As imagens abaixo representam macroscopicamente tumores malignos pulmonares. Sobre esses tumores, assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/JjKePlM.png",
    "alternativas": {
      "a": "A tem alta probabilidade de representar um câncer de pulmão associado a síndrome paraneoplásica.",
      "b": "B tem alta probabilidade de representar um câncer de pulmão associado a uma história de tabagismo.",
      "c": "B é sugestiva de um adenocarcinoma.",
      "d": "A é sugestiva de um carcinoma."
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a alternativa correta sobre o que diferencia diarreia crônica da aguda.",
    "imagem": null,
    "alternativas": {
      "a": "Causa bacteriana ou viral.",
      "b": "Diarreia crônica apresenta sangue e pus.",
      "c": "Diarreia crônica dura menos de 2 semanas.",
      "d": "Diarreia crônica dura mais de 2 semanas."
    },
    "correta": "d"
  },
  {
    "enunciado": "Sobre as enterocolites parasitárias: I. A criptosporidiose é caracterizada como uma doença gastrentérica decorrente de um protozoário parasita extracelular observado na imagem A.  II. A imagem B revela Ascaris, um verme redondo cuja a doença é causada quando as suas larvas migram da circulação esplâncnica para a circulação sistêmica e criam um abscesso hepático ou pneumonite do Ascaris.  III. A imagem C revela enterite infecciosa por Giardia lamblia presentes no espaço luminal; seu formato facilita a ligação aos enterócitos vilosos da borda em escova, gerando apoptose das células epiteliais.  IV. A imagem D revela processo inflamatório eosinofílico patognomônico do parasita exibido na imagem B.  Assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/k9I8RiQ.png",
    "alternativas": {
      "a": "II e III estão corretas.",
      "b": "I e IV estão corretas.",
      "c": "III e IV estão corretas.",
      "d": "I e II estão corretas."
    },
    "correta": "a"
  },
  {
    "enunciado": "Observe as imagens referentes a fragmentos de tireoide. Assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/QYhbMhw.png",
    "alternativas": {
      "a": "A imagem D sugere paciente apresentando níveis séricos elevados de TSH.",
      "b": "Na imagem B os folículos distendidos tem alta captação de iodo radioativo.",
      "c": "Os folículos tireoidianos da imagem C podem ser encontrados em tireoides de pacientes com hipotireoidismo devido ao excesso de halógenos no organismo, bem como carência de iodo na dieta.",
      "d": "A imagem A é compatível com o estágio hiperplásico do bócio difuso atóxico."
    },
    "correta": "a"
  },
  {
    "enunciado": "Um homem de 65 anos de idade trabalhou em um estaleiro por 10 anos e depois trabalhou por 5 para uma empresa que instalava isolamento retardante de fogo.  Ele sofreu de dispneia progressiva por vários anos e, por fim, morreu devido a uma insuficiência respiratória progressiva com hipoxemia.  Na necropsia, detectou a presença de massa rígida, de cor acastanhada, que envolvia o pulmão esquerdo, sugestiva de provavelmente um mesotelioma maligno.  Qual dos seguintes achados mais provavelmente foi observado no parênquima pulmonar desse paciente?",
    "imagem": "https://i.imgur.com/Gx3Wzan.png",
    "alternativas": {
      "a": "Achado da Imagem B",
      "b": "Achado da Imagem C",
      "c": "Achado da Imagem D",
      "d": "Achado da Imagem A"
    },
    "correta": "a"
  },
  {
    "enunciado": "Um dia após comer mariscos crus ou pouco cozidos, uma mulher saudável desenvolveu uma diarreia aquosa profusa/volumosa.  No exame físico, sua temperatura era de 37,50C. O resultado da amostra fecal foi negativo para sangue oculto.  Não havia distensão abdominal ou sensibilidade, e os sons intestinais estavam presentes. A diarreia permanecera por 3 dias.  Qual dos seguintes organismos mais provavelmente está envolvido na produção de tais achados?",
    "imagem": null,
    "alternativas": {
      "a": "Vibrio cholerae.",
      "b": "Ascaris lumbricoides.",
      "c": "Giardia Lamblia.",
      "d": "Cryptosporidium."
    },
    "correta": "a"
  },
  {
    "enunciado": "Um homem de 45 anos de idade fumava dois maços de cigarros por dia, durante 20 anos.  Há 5 anos, ele vem sofrendo de uma tosse crônica com copiosa expectoração mucosa.  Durante o último ano, ele manifestou vários episódios de infecções do trato respiratório.  A radiografia do tórax revela uma silhueta cardíaca direita proeminente.  Qual das seguintes condições patológicas descreve melhor tais achados clínicos?",
    "imagem": null,
    "alternativas": {
      "a": "Enfisema predominante.",
      "b": "Bronquite crônica predominante.",
      "c": "Bronquite crônica com Cor pulmonale.",
      "d": "Bronquite crônica com enfisema."
    },
    "correta": "c"
  },
  {
    "enunciado": "Moléculas de alto peso molecular, contendo halogênios e/ou anéis aromáticos condensados, como é o caso dos agrotóxicos organoclorados, quando em excesso no organismo podem gerar na tireoide:",
    "imagem": "https://i.imgur.com/ZfYDVsl.png",
    "alternativas": {
      "a": "Bloqueio da molécula que transporta o iodo chamada pendrina.",
      "b": "Inibição na adição de carboidrato à proteína tirosina no interior das cisternas do retículo e no complexo de Golgi das células foliculares.",
      "c": "Um aumento de tamanho, ou seja, bócio, que inicialmente pode ser representado microscopicamente pela imagem.",
      "d": "Queda na síntese de T3 e T4, induzindo aumento de TSH, o que provoca hipertrofia e hiperplasia das células foliculares na tentativa de manter o estado metabólico eutireoideo."
    },
    "correta": "d"
  },
  {
    "enunciado": "Um homem de 50 anos de idade vem ao médico com dispneia de agravamento gradual e uma perda ponderal de 4 kg ao longo dos últimos 2 anos.  Não relata tosse produtiva. Ele admite que, durante 20 anos, fumava 2 maços de cigarros por dia, mas afirma que não fumou no último ano.  O exame físico revela um aumento do diâmetro anteroposterior do tórax (\"tórax em barril\").  A ausculta do tórax aponta redução dos sons pulmonares.  A radiografia de tórax exibe pulmões hipertransparentes bilaterais; a transparência está especialmente acentuada nos lobos superiores.  Os testes de função pulmonar mostram que a razão entre volume expiratório forçado no primeiro segundo e a capacidade vital está diminuída.  Entre as opções seguintes, assinale a alternativa correta:",
    "imagem": "https://i.imgur.com/ukbuDg6.png",
    "alternativas": {
      "a": "Os achados do paciente são predominantemente os de uma doença pulmonar obstrutiva caracterizada pela imagem B.",
      "b": "O hábito de fumar do paciente pode desencadear um aumento da produção de elastase pelos neutrófilos e macrófagos, resultando na perda do retrocesso elástico.",
      "c": "Há uma elevada probabilidade do paciente apresentar a alteração cardíaca indicada pela imagem A.",
      "d": "A patogênese da doença descrita envolve o comprometimento da liberação hepática de a1-antitripsina."
    },
    "correta": "b"
  },
  {
    "enunciado": "Várias crianças de 3 a 6 anos de idade foram admitidas a um hospital local em virtude de crise encefalopática.  Elas moram na mesma comunidade desde que nasceram. Todas já haviam exibido anteriormente retardo no desenvolvimento psicomotor.  Ao exame físico, as crianças apresentavam dor abdominal difusa e sofriam de náuseas e vômitos.  Varreduras de TC do crânio apontam edema cerebral marcante. Estudos laboratoriais mostram anemia microcítica.  Um pesquisador enviado à comunidade em que as crianças moravam encontra um conjunto de apartamentos decadentes com vazamentos graves, encanamento deficiente, falta de ventilação e pintura descascada.  A exposição tóxica a qual das seguintes substâncias responde melhor por tais achados?",
    "imagem": null,
    "alternativas": {
      "a": "Mercúrio.",
      "b": "Arsênico.",
      "c": "Chumbo.",
      "d": "Cádmio."
    },
    "correta": "c"
  },
  {
    "enunciado": "Um agricultor de 35 anos é admitido no hospital com sintomas de intoxicação por pesticida.  Qual exame você solicitaria para confirmar a intoxicação por carbamato?",
    "imagem": null,
    "alternativas": {
      "a": "Dosagem de acetilcolinesterase (AChE) no sangue.",
      "b": "Dosagem de carbamato no sangue.",
      "c": "Análise da urina para detectar metabólitos de carbamato.",
      "d": "Hemograma completo."
    },
    "correta": "a"
  },
  {
    "enunciado": "Na intoxicação pelo chumbo podemos encontrar lesões em diferentes órgãos e sistemas. Em qual das alternativas abaixo a lesão morfológica NÃO está corretamente relacionada a esta condição?",
    "imagem": null,
    "alternativas": {
      "a": "Inibição dos neurotransmissores causada pela interrupção da homeostasia do cálcio - Efeitos neurotóxicos.",
      "b": "Lesão tubular proximal - Nefropatia tubular.",
      "c": "Diminuição da condrogênese e aumento do retardo da mineralização da cartilagem - Inibição a cicatrização de fraturas.",
      "d": "Pontilhado basófilo nas hemácias - Anemia microcítica."
    },
    "correta": "c"
  },
  {
    "enunciado": "A respeito da toxicidade do mercúrio (Hg), assinale a alternativa correta.",
    "imagem": null,
    "alternativas": {
      "a": "O mercúrio inorgânico causa efeito de bioacumulação nos seres vivos.",
      "b": "A inalação do vapor de mercúrio é caracterizada por fadiga e bradicardia.",
      "c": "O vapor de mercúrio é muito mais perigoso do que o mercúrio líquido.",
      "d": "O mercúrio iônico é a principal fonte de toxicidade humana por mercúrio."
    },
    "correta": "c"
  },
  {
    "enunciado": "A contaminação por metal arsênio poderá ocorrer de forma aguda ou crônica, interferindo na produção de proteínas com propriedades de se ligarem aos metais, causando prejuízos a vários sistemas no organismo. Assinale a alternativa do mecanismo de toxicidade deste metal.",
    "imagem": null,
    "alternativas": {
      "a": "Danos no DNA por estresse oxidativo, alteração no estado de metilação do DNA e intensificação no reparo do DNA.",
      "b": "Danos no RNA por estresse oxidativo, alteração no estado de metilação do RNA e comprometimento no reparo do RNA.",
      "c": "Danos no DNA por estresse oxidativo, alteração no estado de metilação do DNA e comprometimento no reparo do DNA.",
      "d": "Danos na mitocôndria por estresse oxidativo, alteração no estado de fosforilação mitocondrial e comprometimento no reparo do DNA."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa correta da principal ação tóxica pelo mercúrio.",
    "imagem": null,
    "alternativas": {
      "a": "É responsável pela modulação dos canais iônicos das células.",
      "b": "Sua diminuição nos tecidos, em especial no SNC, é responsável pela neurotoxicidade.",
      "c": "A sua ligação aos grupos sulfidrilas resultará na ativação da ferroquelatase, interferindo na formação do heme.",
      "d": "A sua ligação aos grupos ativos da enzima monoaminoxidase, resultará no acúmulo de serotonina endógena."
    },
    "correta": "d"
  },
  {
    "enunciado": "Paciente, gênero masculino, 18 anos, procura a emergência por dor abdominal intensa, tipo cólica, associada a náusea, vômito e evacuações diarreicas. Na anamnese encontrava-se abatido, com episódios de contorção por dor abdominal. Dados vitais estáveis, uma leve taquicardia e febre de 38,5 graus. Assinale a alternativa que indica o melhor exame laboratorial que deve ser realizado para identificação do microrganismo patogênico.",
    "imagem": null,
    "alternativas": {
      "a": "Pesquisa de antígenos de Giardia lamblia no soro por ELISA",
      "b": "Cultura em meio seletivo e diferencial, para identificação posterior do agente bacteriano causador da diarreia.",
      "c": "Pesquisa de anticorpos contra Giardia lamblia nas fezes por ELISA.",
      "d": "Repicar as colônias de rotavirus desenvolvidas em meio Rugai, que é um indicativo presuntivo do agente causador da diarreia."
    },
    "correta": "b"
  },
  {
    "enunciado": "Para muitos diarreia é somente o aumento do numeros de evacuações, porém de acordo com a sua fisiopatologia poderá ser classificada em tipos distintos. Assinale a alternativa correta que caracteriza a diarreia osmolar.",
    "imagem": null,
    "alternativas": {
      "a": "É caracterizada pelo aumento exagerado da osmolaridade na luz intestinal, ocasionado pela presença de vírus, bactérias ou carboidratos neste local.",
      "b": "É caracterizada por um distúrbio de absorção provocado pela presença de toxinas na região intestinal.",
      "c": "É caracterizada pela agressão de patógenos não invasivos que agridem o intestino delgado com sua toxinas, desta forma promovem a secreção abundante de água e eletrólitos.",
      "d": "É caracterizada pelo aumento exagerado da osmolaridade na luz intestinal, ocasionado pela presença de toxinas bacterianas neste local."
    },
    "correta": "a"
  },
  {
    "enunciado": "Criança, 1 ano e 3 meses, foi levada a UPA pela mãe com quadro de diarreia aquosa sem muco, febre acima de 39 graus e assadura. A hipótese diagnóstica mais provável foi de rotavirose. Nesse caso, o exame mais apropriado para o diagnóstico diferencial com outros quadros diarreicos causados por vírus seria a investigação do vírus nas fezes do paciente, através da:",
    "imagem": null,
    "alternativas": {
      "a": "detecção de antígenos pelo método de coprocultura.",
      "b": "detecção de anticorpos pelo método de coprocultura.",
      "c": "detecção de antígenos por imunodiagnóstico (ELISA).",
      "d": "detecção de anticorpos por imunodiagnóstico (ELISA)."
    },
    "correta": "d"
  },
  {
    "enunciado": "Diarreia aguda não inflamatória provocada por enterotoxina pode ser desencadeada por qual dos agentes abaixo?",
    "imagem": null,
    "alternativas": {
      "a": "Salmonella.",
      "b": "E. coli produtora de toxina Shiga.",
      "c": "Shigella.",
      "d": "Escherichia coli enterotoxigênica."
    },
    "correta": "d"
  },
  {
    "enunciado": "A diarréia é um desarranjo do intestino com o aumento de número de evacuações e fezes amolecidas ou líquidas. Assinale a alternativa correta da classificação das diarreias.",
    "imagem": null,
    "alternativas": {
      "a": "Osmolar - excretora - reabsortiva.",
      "b": "Hiperosmolar - excretora - disabsortiva.",
      "c": "Osmolar - secretora - disabsortiva.",
      "d": "Hiperosmolar - tóxica - hemorrágica."
    },
    "correta": "c"
  },
  {
    "enunciado": "Sobre Giardíase e Cólera, respectivamente, podemos encontrar:",
    "imagem": null,
    "alternativas": {
      "a": "Atrofia das vilosidades intestinais em casos de infecções profundas; Bacilos provocam erosões da mucosa colônica.",
      "b": "Altamente ligados aos enterócitos vilosos da borda em escova para posterior invasão; Podem, através da veia porta, atingir o fígado causando abscessos.",
      "c": "Na forma de cistos resistentes ao cloro; Vibrio são não invasivos e permanecem no lúmen intestinal.",
      "d": "Mucosa intestinal normal ou com discreto infiltrado inflamatório; Diarreia aquosa grave provocada por úlceras com entrada estreita e base larga causadas pelo recrutamento de macrófagos."
    },
    "correta": "a"
  },
  {
    "enunciado": "Indique a alternativa correta sobre a estrutura interna do rim.",
    "imagem": null,
    "alternativas": {
      "a": "A coluna renal situa-se entre as pirâmides renais medulares.",
      "b": "Os cálices maiores são a expansão afunilada da extremidade superior do ureter.",
      "c": "a cápsula fibrosa do rim separa o córtex da medula renal.",
      "d": "A papila renal encontra-se na base da pirâmide renal medular."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa mais correta sobre a origem dos nervos das glândulas suprarrenais.",
    "imagem": null,
    "alternativas": {
      "a": "Plexo mesentérico superior e nervo esplâncnico menor.",
      "b": "Plexo celíaco e nervos esplâncnicos abdominopélvicos.",
      "c": "Nervos esplâncnicos maior, menor e imo.",
      "d": "Plexo mesentérico inferior e nervo esplâncnico maior."
    },
    "correta": "b"
  },
  {
    "enunciado": "Assinale a opção correta sobre os segmentos broncopulmonares.",
    "imagem": null,
    "alternativas": {
      "a": "Supridos pelos mesmos ramos que nutrem os lobos pulmonares, a partir da sisculação sistêmica.",
      "b": "Geralmente, há 10 segmentos no pulmão direito e de 8 a 10 no pulmão esquerdo.",
      "c": "Separados dos segmentos adjacentes por septos de tecido conjuntivo.",
      "d": "Nomeados de acordo como brônquio lobar que os origina."
    },
    "correta": "b"
  },
  {
    "enunciado": "É uma característica do brônquio principal:",
    "imagem": null,
    "alternativas": {
      "a": "Ser formado por anéis completos de cartilagem.",
      "b": "Localizar-se no mediastino.",
      "c": "Ser identificado inerso no parênquima pulmonar.",
      "d": "Possuir ilhotas fragmentadas de cartilagem."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa correta sobre a origem dos nervos simpáticos da glândula da tireoide.",
    "imagem": null,
    "alternativas": {
      "a": "Nervo laringeo recorrente.",
      "b": "Gânglios cervicais superiores, médios e inferiores.",
      "c": "Nervo laringeo superior.",
      "d": "Nervos esplâncnicos cardiopulmonares."
    },
    "correta": "a"
  },
  {
    "enunciado": "Indique a alternativa correta sobre a origem dos brônquios segmentares superiores.",
    "imagem": null,
    "alternativas": {
      "a": "Brônquio lobar superior esquerdo.",
      "b": "Brônquios lobares inferiores.",
      "c": "Brônquio lobar superior direito.",
      "d": "Brônquio lobar médio direito."
    },
    "correta": "b"
  },
  {
    "enunciado": "Sobre a drenagem da glândula tireoide o mais correto é:",
    "imagem": null,
    "alternativas": {
      "a": "A veia tiroidea inferior drena no tronco braquiocefálico.",
      "b": "A veia tiroidea superior drena diretamente apara a veia jugular externa.",
      "c": "Pode ocorrer a formação de um tronco entre as veias tiroidea superior e inferior.",
      "d": "A veia tiroidea média drena para a veia subclávia."
    },
    "correta": "a"
  },
  {
    "enunciado": "Indique a região localizada na margem medial que dá acesso ao seio renal, por onde atravessam os vasos e nervos.",
    "imagem": null,
    "alternativas": {
      "a": "Gordura perirrenal.",
      "b": "Hilo renal.",
      "c": "Fáscia renal.",
      "d": "Cápsula renal."
    },
    "correta": "c"
  },
  {
    "enunciado": "Indique a alternativa correta sobre a origem da artéria suprarrenal média.",
    "imagem": null,
    "alternativas": {
      "a": "Artéria mesentérica superior.",
      "b": "Aorta descendente parte abdominal.",
      "c": "Artéria renal.",
      "d": "Tronco celíaco."
    },
    "correta": "d"
  },
  {
    "enunciado": "Canabinoides são substâncias presentes em plantas do gênero Cannabis sativa, popularmente conhecida no Brasil como maconha. Assinale a alternativa que descreve corretamente o principal constituinte responsável pelos efeitos psicoativos desta droga.",
    "imagem": null,
    "alternativas": {
      "a": "Cannabis.",
      "b": "Canabinol.",
      "c": "Delta-9-tetrahidrocanabinol.",
      "d": "Canabidiol."
    },
    "correta": "c"
  },
  {
    "enunciado": "Em uma prova de farmacologia você recebeu as seguintes características sobre uma droga: Pode ser detectada após 3 a 4 horas de consumo. É mantida no organismo por um período de 24 a 48 horas, após o último consumo. É uma droga detectável no teste rápido. Com base nestas característica, assinale a alternativa correta da droga de abuso em questão.",
    "imagem": null,
    "alternativas": {
      "a": "MDMA e maconha.",
      "b": "Cocaína e ectasy.",
      "c": "Maconha e cocaína.",
      "d": "Anfetaminas e metanfetaminas."
    },
    "correta": "d"
  },
  {
    "enunciado": "Atualmente, as principais fontes de exposição ao mercúrio são os peixes contaminados (metil mercúrio) e os vapores de mercúrio liberados pelo mercúrio metálico em amálgamas dentários, um possível risco ocupacional para profissionais da área dental. Com relação aos danos decorrentes do envenenamento por mercúrio podemos encontrar:",
    "imagem": null,
    "alternativas": {
      "a": "Alteração nas funções neuromotoras, cognitivas e comportamentais, pois a solubilidade dos lipídios do metil mercúrio e do mercúrio metálico facilita o seu acúmulo no cérebro.",
      "b": "Interferência com a remodelação normal da cartilagem e nas trabéculas ósseas primárias nas epífises em crianças.",
      "c": "Redução na excreção do ácido úrico, o que pode levar à gota saturnina.",
      "d": "Neuropatia periférica desmielinizante em adultos."
    },
    "correta": "d"
  },
  {
    "enunciado": "Na evolução da doença pulmonar obstrutiva crônica pode ocorrer comprometimento do coração, denominado \"cor pulmonale crônico\". Com relação a este quadro está correto afirmar:",
    "imagem": null,
    "alternativas": {
      "a": "Os ventrículos direito e esquerdo apresentam, respectivamente, hipertrofia concêntrica e dilatação.",
      "b": "Ocorre com maior frequência no paciente com enfisema.",
      "c": "Decorre da diminuição do leito vascular pulmonar e consequente aumento da pressão pulmonar.",
      "d": "No ventrículo direito ocorre remodelamento do miocárdio com fibrose."
    },
    "correta": "c"
  },
  {
    "enunciado": "A exposição ao monóxido de carbono (CO) pode levar a arritmias e piora de quadros isquêmicos do tecido cardíaco. Assinale a alternativa que melhor descreva o mecanismo que leva aos sintomas mencionados na afirmativa anterior.",
    "imagem": null,
    "alternativas": {
      "a": "Alto nível de carboxihemoglobina leva a hipertensão arterial.",
      "b": "A alta afinidade do CO pela mioglobina.",
      "c": "A alta afinidade do CO pela hemoglobina.",
      "d": "Alto nível de carboxihemoglobina leva a vasoconstrição."
    },
    "correta": "b"
  },
  {
    "enunciado": "Um operário trabalhando na limpeza de um túnel, sem os EPIs apropriado para o trabalho, após 15 minutos exercendo sua função apresentou alguns sintomas típicos de intoxicação. Assinale a alternativa do agente responsável pela intoxicação e seus sintomas.",
    "imagem": null,
    "alternativas": {
      "a": "Dióxido de carbono (CO2); delirium, coma e bradicardia.",
      "b": "Monóxido de carbono (CO); taquicardia, cefaléia e sonolência.",
      "c": "Dióxido de carbono (CO2); agitação seguida de depressão, vômito e fraqueza muscular.",
      "d": "Monóxido de carbono (CO); agitação, taquicardia e delirium."
    },
    "correta": "b"
  },
  {
    "enunciado": "Com relação às características tóxicas do monóxido de carbono, esse gás é classificado como:",
    "imagem": null,
    "alternativas": {
      "a": "Estimulante.",
      "b": "Asfixiante químico.",
      "c": "Neurotóxico.",
      "d": "Inibidor da atividade das colinesterases."
    },
    "correta": "b"
  },
  {
    "enunciado": "Indivíduo de 25 anos, foi levado ao pronto socorro pelos pais, foi encontrado desacordado dentro do carro ligado na garagem (ambiente fechado). Considere que este indivíduo apresentou um quadro de intoxicação por monóxido de carbono. Assinale a alternativa correta sobre os testes diagnósticos neste caso.",
    "imagem": null,
    "alternativas": {
      "a": "A forma de mensurar a carboxihemoglobina no plasma é pelo método de cooximetria, através da imunocromatografia.",
      "b": "Nos exames laboratoriais, fumantes geralmente apresentam níveis séricos plasmáticos de carboxihemoglobina inferiores a 2%.",
      "c": "Não será realizado a monitoração de oxigênio por oximetria de pulso, pois este tipo de dosagem não diferencia a carboxihemoglobina da oxihemoglobina no plasma.",
      "d": "Nos exames laboratoriais, não fumantes geralmente apresentam níveis séricos plasmáticos de carboxihemoglobina iguais a 5%."
    },
    "correta": "c"
  },
  {
    "enunciado": "Assinale a alternativa que descreva corretamente um dos mecanismos de intoxicação por monóxido de carbono (CO).",
    "imagem": null,
    "alternativas": {
      "a": "O CO se liga à citocromo-oxidase, causando estresse oxidativo com consequente dano mitocondrial e eventos inflamatórios.",
      "b": "O CO no cérebro inibe a ativação de aminoácidos excitatórios e induz a morte de células neuronais.",
      "c": "O CO causa hipertensão em função da depressão miocárdica e vasodilatação.",
      "d": "O CO tem uma afinidade pela hemoglobina muito menor que a mioglobina e, dessa forma, o CO inalado é acumulado nos músculos."
    },
    "correta": "a"
  },
  {
    "enunciado": "Um trabalhador rural lavou o recipiente de agrotóxico para reutiliza-lo. Após horas, apresentou salivação e lacrimejameto com sudorese. No hospital da região, após a anamnese, é correto dizer que o médico solicitaria:",
    "imagem": null,
    "alternativas": {
      "a": "Dosagem de colinesterase eritrocitária, que informará se ocorreu uma absorção rápida do agrotóxico.",
      "b": "Dosagem de colinesterase plasmática, que informará a absorção tardia do agrotóxico.",
      "c": "Dosagem de colinesterase eritrocitária, que informará a absorção tardia do agrotóxico.",
      "d": "Dosagem de colinesterase plasmática, que informará se ocorreu uma absorção rápida do agrotóxico."
    },
    "correta": "d"
  },
  {
    "enunciado": "Paciente de 49 anos, sexo masculino, garçom, deu entrada no pronto socorro após tentativa de suicídio com substância não identificada. Dentre os sintomas o paciente apresentava: sudorese, taquicardia, convulsões e fraqueza muscular. Levando em consideração o conhecimento adquirido nesse módulo, assinale a alternativa correta:",
    "imagem": null,
    "alternativas": {
      "a": "Foi realizado o Teste de Reinsch que teve resultado positivo para o mercúrio. Associando com os sintomas apresentados pelo paciente na chegada ao pronto socorro é possível sugerir que a tentativa de suicídio foi devido a exposição ao mercúrio.",
      "b": "Foi realizada a dosagem da colinesterase eritrocitária que apresentou resultado de 630 U/L (Valor de referência: 2600 - 4100 U/L), associando com os sintomas apresentados pelo paciente na chegada ao pronto socorro é possível sugerir que a tentativa de suicidio foi com carbamato ou organofosforado.",
      "c": "Foi realizado o Teste de Reinsch que teve resultado positivo para o chumbo. Associando com os sintomas apresentados pelo paciente na chegada ao pronto socorro é possível sugerir que a tentativa de suicídio foi devido a exposição ao chumbo.",
      "d": "Foi realizada a dosagem da colinesterase plasmática que apresentou resultado de 2100 U/L (Valor de referência: 1900 - 3800 U/L), associando com os sintomas apresentados pelo paciente na chegada ao pronto socorro é possível sugerir que a tentativa de suicidio foi com carbamato ou organofosforado."
    },
    "correta": "a"
  },
  {
    "enunciado": "Seu Mauricio estava muito entristecido, querendo saber o que aconteceu com seu cachorro e companheiro. Ele acreditava que Tufão havia comido alimento estragado. Agora estava com ele no veterinário, salivando bastante e com muita fraqueza muscular. O veterinário informou que aqueles sintomas não eram de comida estragada e que seria muito provavelmente um tipo de envenenamento. Esta sintomatologia é característica de envenenamento por:",
    "imagem": null,
    "alternativas": {
      "a": "Malation um tipo de organoclorado.",
      "b": "Chumbinho um tipo de organoclorado.",
      "c": "Chumbinho um tipo de carbamato.",
      "d": "Malation um tipo de carbamato."
    },
    "correta": "c"
  },
  {
    "enunciado": "A intoxicação por organofosforados resulta em uma hiper estimulação de receptores na fenda sináptica. Assinale a alternativa que indique corretamente o receptor e neurotransmissor envolvidos nesse processo.",
    "imagem": null,
    "alternativas": {
      "a": "Muscarínico e muscarina.",
      "b": "Nicotínico e acetilcolina.",
      "c": "Nicotínico e acetilcolinesterase.",
      "d": "Muscarínico e colina."
    },
    "correta": "a"
  },
  {
    "enunciado": "Muitas das manifestações associadas com a intoxicação por organofosforados são relacionadas ao acúmulo de neurotransmissor na fenda sináptica. Entretanto, devido a dificuldade em coletar amostras que contenham a enzima acetilcolinesterase presente nos neurônios, se faz necessário utilizar amostras mais acessíveis e que sejam informativas. Dessa forma, assinale a alternativa que corretamente indique o tipo de amostra e a enzima avaliada.",
    "imagem": null,
    "alternativas": {
      "a": "Amostra de líquido cefalorraquidiano para avaliar a atividade da butirilcolinesterase verdadeira.",
      "b": "Amostra de sangue para avaliar a atividade da pseudocolinesterase presente no plasma sanguíneo.",
      "c": "Amostra de sangue para avaliar a atividade da acetilcolinesterase verdadeira presente nas hemácias.",
      "d": "Amostra de saliva para avaliar a atividade da butirilcolinesterase."
    },
    "correta": "a"
  },
  {
    "enunciado": "Com relação à intoxicação pelo chumbo analise as afirmativas abaixo e assinale a alternativa correta. I. Crianças absorvem mais chumbo do que adultos. II. Adultos geralmente apresentam manifestações neurológicas periféricas, enquanto crianças apresentam manifestações neurológicas centrais. III. Causa anemia hipocrômica e microcítica. IV. Intoxicação subclínica em criança pode se manifestar como déficit de atenção e hiperatividade. Estão corretas somente:",
    "imagem": null,
    "alternativas": {
      "a": "II e IV.",
      "b": "I, II, III e IV.",
      "c": "I, II e III.",
      "d": "III e IV."
    },
    "correta": "b"
  },
  {
    "enunciado": "Sr. José das Pedras, trabalhador desde a adolescência em um garimpo na região de Mato Grosso, foi levado ao hospital de emergências. Após anamnese o médico suspeitou de contaminação por metais pesados. Solicitou o teste de Reinsh para confirmação da hipótese diagnóstica. Assinale a alternativa correta com relação a este teste.",
    "imagem": null,
    "alternativas": {
      "a": "É um teste qualitativo, realizado na urina, identifica a intoxicação por algum tipo de metal pesado, mas não servindo para quantificar.",
      "b": "É um teste qualitativo, realizado no sangue, identifica a intoxicação por algum tipo de metal pesado, mas não servindo para quantificar.",
      "c": "É um teste quantitativo, realizado na urina, identifica e quantifica a intoxicação por de algum tipo de metal pesado.",
      "d": "É um teste quantitativo, realizado na sangue, identifica e quantifica a intoxicação por de algum tipo de metal pesado."
    },
    "correta": "a"
  },
  {
    "enunciado": "Com relação à intoxicação por chumbo (Pb), é correto afirmar:",
    "imagem": null,
    "alternativas": {
      "a": "A adsorção significativa do Pb ocorrerá sempre que a capacidade de ligação da transferrina estiver excedida.",
      "b": "O Pb dificilmente será absorvido no trato gastrointestinal se a integridade da mucosa estiver preservada.",
      "c": "O Pb é um metal pesado amplamente utilizado em herbicidas.",
      "d": "O Pb causa seu efeito tóxico mais severo no sistema nervoso central e periférico."
    },
    "correta": "d"
  },
  {
    "enunciado": "Efeitos neurocognitivos associados ao monóxido de carbono podem se desenvolver em até 40 dias após a exposição. Baseado nessa afirmativa, assinale a alternativa que melhor explique esse processo.",
    "imagem": null,
    "alternativas": {
      "a": "No cérebro, simultaneamente ao estresse oxidativo perivascular, há inativação de aminoácidos excitatórios e morte de células neuronais.",
      "b": "No cérebro, o excesso de carboxihemoglobina leva a hipertensão em decorrência da depressão miocárdica e vasoconstrição. Consequentemente há morte celular e perda funcional do SNC.",
      "c": "No cérebro, simultaneamente ao estresse oxidativo perivascular, há ativação de aminoácidos excitatórios, processos inflamatórios e morte de células neuronais.",
      "d": "No cérebro, o excesso de carboxihemoglobina leva a hipotensão em decorrência da depressão miocárdica e vasoconstrição. Consequentemente há necrose de neurônios e perda funcional do SNC."
    },
    "correta": "c"
  },
  {
    "enunciado": "Nas situações de incêndio há a produção de fumaça tóxica, que é o resultado da combustão incompleta de combustíveis fósseis. Assinale a alternativa correta da substância química encontrada nesta fumaça, além do monóxido de carbono.",
    "imagem": null,
    "alternativas": {
      "a": "Cloreto.",
      "b": "Carbonato.",
      "c": "Dióxido de carbono.",
      "d": "Cianeto."
    },
    "correta": "d"
  },
  {
    "enunciado": "Para diagnóstico de paciente vítima de exposição às fumaças tóxicas, além do exame clínico, qual o exame laboratorial específico que indicará o nível de comprometimento das hemoglobinas?",
    "imagem": null,
    "alternativas": {
      "a": "Dosagem do ferro sérico.",
      "b": "Dosagem da atividade das colinesterases.",
      "c": "Dosagem do nível de carboxihemoglobina.",
      "d": "Dosagem de sulfeto."
    },
    "correta": "c"
  },
  {
    "enunciado": "Moléculas de alto peso molecular, contendo halogênios e/ou anéis aromáticos condensados, como é o caso dos agrotóxicos organoclorados, quando em excesso no organismo podem gerar na tireoide:",
    "imagem": null,
    "alternativas": {
      "a": "Queda na síntese de T3 e T4, induzindo aumento de TSH, o que provoca hipertrofia e hiperplasia das células foliculares na tentativa de manter o estado metabólico eutireoideo.",
      "b": "Um aumento de tamanho, ou seja, bócio, que inicialmente pode ser representado microscopicamente pela imagem.",
      "c": "Bloqueio da molécula que transporta o iodo chamada pendrina.",
      "d": "Inibição na adição de carboidrato à proteína tirosina no interior das cisternas do retículo e no complexo de Golgi das células foliculares."
    },
    "correta": "a"
  },
  {
    "enunciado": "Assinale a alternativa correta da diferença entre a dosagem da enzima colinesterase plasmática e eritrocitária:",
    "imagem": null,
    "alternativas": {
      "a": "A dosagem da colinesterase plasmática é utilizada para confirmação de contaminação crônica.",
      "b": "A dosagem da colinesterase plasmática é utilizada para rastreio.",
      "c": "A dosagem da colinesterase eritrocitária é utilizada para confirmação.",
      "d": "A dosagem da colinesterase plasmática e eritrocitária é utilizada para a confirmação de contaminação, sendo uma aguda e outra crônica."
    },
    "correta": "d"
  },
  {
    "enunciado": "Laboratorialmente podemos pedir a dosagem de colinesterase plasmática e eritrocitária. Assinale a alternativa que melhor explica a diferença entre as dosagens.",
    "imagem": null,
    "alternativas": {
      "a": "A plasmática indica a absorção do monóxido de carbono em uma contaminação crônica, enquanto a eritrocitária indica o efeito tóxico de uma contaminação aguda.",
      "b": "A plasmática indica a absorção do monóxido de carbono em uma contaminação aguda, enquanto a eritrocitária indica o efeito tóxico de uma contaminação crônica.",
      "c": "A plasmática indica a absorção do organofosforado em uma contaminação crônica, enquanto a eritrocitária indica o efeito tóxico de uma contaminação aguda.",
      "d": "A plasmática indica a absorção do organofosforado em uma contaminação aguda, enquanto a eritrocitária indica o efeito tóxico de uma contaminação crônica."
    },
    "correta": "d"
  },
  {
    "enunciado": "Vários microrganismo são responsabilizados pelos quadros de diarréias ocorrendo em países subdesenvolvidos e com pouco ou nenhum saneamento. Além destes fatores contribuirem para os quadros diarréicos, assinale a alternativa do fator de transmissão que mais corrobora para as diarreias.",
    "imagem": null,
    "alternativas": {
      "a": "A maioria dos agentes infecciosos são transmitidos por animalis domésticos e por alimentos com prazo de validade vencido.",
      "b": "A maioria dos agentes infecciosos são de transmissão oro-fecal transmitidos também por alimentos mau condicionados.",
      "c": "A maioria dos agentes infecciosos são de transmissão oro-fecal, afetando principalmente as crianças que não apresentam o calendário vacinal em dia.",
      "d": "A maioria dos agentes infecciosos são de transmissão por alimentos embutidos, carnes cruas e frutas e verduras sem higienização correta."
    },
    "correta": "b"
  },
  {
    "enunciado": "Paciente, gênero masculino, 55 anos, levou exames de fezes ao laboratório da sua cidade em embalagem de margarina, explicou que colheu a amostra há 2 dias, colocou na geladeira, mas nas últimas 12 horas teve corte de enrgia elétrica da casa. A recepcionista explicou que não poderia receber a amostra, pois não havia sido coletada corretamente. Assinale a alternativa correta sobre os padrões de coleta apropriados para realização deste exame.",
    "imagem": null,
    "alternativas": {
      "a": "Amostra deverá ser coletada em frasco apropriado e processada em até 10 horas após a coleta, podendo ser refrigerada de 2 a 8 graus C até 24 horas, desde que estejam com um meio conservante.",
      "b": "Amostra deverá ser coletada em frasco apropriado e processada em até 1 hora após a coleta, podendo ser refrigerada de 2 a 8 graus C até 24 horas, desde que estejam com um meio conservante.",
      "c": "Amostra deverá ser coletada em frasco apropriado e processada em até 10 horas após a coleta, podendo ser refrigerada de 2 a 8 graus C até 48 horas, desde que estejam com um meio conservante.",
      "d": "Amostra deverá ser coletada em frasco apropriado e processada em até 1 hora após a coleta, podendo ser refrigerada de 2 a 8 graus C até 48 horas, desde que estejam com um meio conservante."
    },
    "correta": "b"
  },
  {
    "enunciado": "Dentre os mecanismo de virulência dos agentes infecciosos causadores de diarreias agudas, existe o de adesão à mucosa intestinal, invasão das células epiteliais ou lâmina própria ou produção de toxinas que causam secreção exagerada de sais e água ou necrose tecidual por lesão celular. Sendo assim, são agentes que sintetizam toxinas:",
    "imagem": null,
    "alternativas": {
      "a": "Salmonella spp e Escherichia coli enteropatogênica (EPEC).",
      "b": "Vibrio cholerae e Escherichia coli enterotoxigênica (ETEC).",
      "c": "Campylobacter e Escherichia coli enterotoxigênica (ETEC).",
      "d": "Giardia lamblia e Escherichia coli enteropatogênica (EPEC)."
    },
    "correta": "b"
  },
  {
    "enunciado": "Uma menina de seis meses de idade é levada à emergência apresentando diarreia liquida e sem sangue e vômitos. Ela tinha febre baixa há 48 horas e estava desidratada. A cultura de microrganismos se mostrou negativa. Qual dos agentes infecciosos abaixo é o mais indicativo para causar a diarreia?",
    "imagem": null,
    "alternativas": {
      "a": "Rotavirus.",
      "b": "Salmonella.",
      "c": "E. coli enteroinvasiva.",
      "d": "E. coli enteroagregativa."
    },
    "correta": "a"
  },
  {
    "enunciado": "Algumas drogas de abuso, após o consumo, são metabolizadas deixando apenas sub-produtos circulantes. A anfetamina apresenta esta característica. Assinale a alternativa correta do metabólito encontrado na urina de um paciente usuário de anfetamina.",
    "imagem": null,
    "alternativas": {
      "a": "p-hidroxianfetamina.",
      "b": "metanfetamina.",
      "c": "anfetamina.",
      "d": "ácido benzoico."
    },
    "correta": "a"
  },
  {
    "enunciado": "As artérias suprarrenais superior, média e inferior tem origem, respectivamente:",
    "imagem": null,
    "alternativas": {
      "a": "a. aorta, a. aorta, a. renal.",
      "b": "a. renal, a. renal, a. aorta.",
      "c": "a. frênica inferior, a. aorta, a. renal.",
      "d": "a. frênica superior, a. aorta, a. frênica inferior."
    },
    "correta": "c"
  },
  {
    "enunciado": "Identifique a alternativa correta sobre a localização dos rins.",
    "imagem": null,
    "alternativas": {
      "a": "O rim direito está aproximadamente um dedo superior à crista ilíaca em um indivíduo em posição ortostática.",
      "b": "Estão situados retroperitonialmente no nível das vértebras L1 a L5.",
      "c": "O terço superior da face anterior do rim direito relaciona-se com o estômago.",
      "d": "O terço inferior da face anterior do rim esquerdo relaciona-se com o intestino delgado."
    },
    "correta": "b"
  },
  {
    "enunciado": "A posição das estruturas no hilo pulmonar é:",
    "imagem": null,
    "alternativas": {
      "a": "brônquios principais mais superiormente posicionados.",
      "b": "brônquios lobares localizados superior e posteriormente.",
      "c": "veias pulmonares mais superiormente dispostas.",
      "d": "artérias pulmonares anteroinferiormente posicionadas."
    },
    "correta": "b"
  }
];

        // --- FIM DAS MODIFICAÇÕES PRINCIPAIS ---

        // Variáveis globais (algumas mantidas, outras adaptadas)
        let allQuestions = []; 
        let currentTestQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let testStatistics = { 
            correct: [],
            incorrect: [],
            attemptsHistory: [],
            performanceByArea: {},
            questionMistakes: {} 
        };
        let answeredQuestions = 0;
        let answeredInBlock = 0;
        let correctInBlock = 0;
        let showFeedbackOnNext = false;
        let currentAttempt = 0; 
        let currentQuizIsReviewMode = false; 
        let hasFinishedCurrentTestProcessing = false;
        let charts = {
            performance: null, progress: null, areas: null, mistakes: null,
            questionSizeChart: null, timePerQuestion: null 
        };

        // Constantes de elementos do DOM
        const quizPage = document.getElementById('quizPage');
        const resultsPage = document.getElementById('resultsPage');
        const currentQuestionDiv = document.getElementById('currentQuestion');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const finishBtn = document.getElementById('finishBtn');
        // const jsonInput = document.getElementById('jsonInput'); // REMOVIDO
        const finalScoreText = document.getElementById('finalScoreText');
        const finalPercentageText = document.getElementById('finalPercentageText');
        const questionsAnalysis = document.getElementById('questionsAnalysis');
        const progressBar = document.getElementById('progressBar');
        const instantFeedback = document.getElementById('instantFeedback');
        
        const feedbackPopup = document.getElementById('feedbackPopup');
        const closeFeedback = document.getElementById('closeFeedback');
        const continueButton = document.getElementById('continueButton');
        const feedbackTotal = document.getElementById('feedbackTotal');
        const feedbackCorrect = document.getElementById('feedbackCorrect');
        const feedbackIncorrect = document.getElementById('feedbackIncorrect');
        const feedbackPercentageValue = document.getElementById('feedbackPercentageValue');
        const feedbackMistakesList = document.getElementById('feedbackMistakesList');
        
        const quizStartOptionsPopup = document.getElementById('quizStartOptionsPopup');
        const quizOptionsPopupTitle = document.getElementById('quizOptionsPopupTitle');
        const quizOptionsPopupSubtitle = document.getElementById('quizOptionsPopupSubtitle');
        const quizOptionsPopupButtons = document.getElementById('quizOptionsPopupButtons');
        
        const questionDetailPopup = document.getElementById('questionDetailPopup');
        const questionDetailContent = document.getElementById('questionDetailContent');

        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeText = document.getElementById('darkModeText');
        const darkModeToggleResults = document.getElementById('darkModeToggleResults');
        const darkModeTextResults = document.getElementById('darkModeTextResults');
        
        const toggleAnalysisBtn = document.getElementById('toggleAnalysisBtn');
        const analysisBox = document.getElementById('analysisBox');
        const correctSound = document.getElementById('correctSound');
        const wrongSound = document.getElementById('wrongSound');
        // const jsonFileListElement = document.getElementById('jsonFileList'); // REMOVIDO
        const quizTitleElement = document.getElementById('quizTitle'); 
        const resultsTitleElement = document.getElementById('resultsTitle');
        const resetStatsBtn = document.getElementById('resetStatsBtn');


       const iframes = [
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/lista-mais-g-y-do-planeta-terra-2-0-1308/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/eu-quero-comer-voce-99397/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/rat-dance-music-93451/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/pou-estourado-48183/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/sua-mae-sabe-que-voce-gosta-de-rapazes-80078/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/toma-milk-shake-de-morango-59364/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/rojao-super-estourado-44057/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/me-da-minha-foia-19424/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/vai-tomar-no-c-pir4nh444-34654/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/lula-e-neymar-47-40647/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/e-agora-vai-entra-o-grosso-75362/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/caramba-que-p1nto-enorme-42382/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/o-homem-uma-maquina-uma-besta-enjaulada-66045/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/manda-foto-pivete-4508/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/som-do-zap-zap-estourado-15594/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/lula-empurra-mole-59742/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/foi-quando-gyro-finalmente-entendeu-41342/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/uicideboy-intro-gmi2-36329/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/abc-da-amazonia-61531/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/corinthians-radio-globo/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/cruzeiro-radio-globo/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/eae-mane-cade-o-pix-mwahahaha-8598/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/posso-te-ligar-agora-ou-tua-mulher-54107/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/para-de-mandar-audio-to-na-ucrania-47141/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/ponte-preta-radio-globo-91750/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/coritiba-radio-globo/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/dolly-estourado-50496/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/imbroxavel-44092/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/lula-ze-gotinha-26753/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/hino-da-urss-53471/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/lobo-pidao-50489/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/voce-vem-almocar-23752/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/vinheta-ifood/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/spongebob-fail-11236/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/botao-do-whatsapp-97196/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/1-2-3-4-flamengo-18569/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/ai-chavinho-25347/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/tralalero-funk-20181/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/indian-song-7sek-58379/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/hello-moto-estourado-73372/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/plantao-globo/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/aw-shit-here-go-again-cj-from-gta-sa-97151/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/cala-a-boca-e-escuta-o-som-da-minha-kombi-ai-2767/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/qui-fase-que-ta-o-curintia-43357/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/musica-triste-meme-41946/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/pare/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/me-ferrei-amigos-estevao-31478/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/ele-ta-pedindo-pra-ser-empurrado-4066/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/papu-papu-papu-58837/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/biometria-13888/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/brasil-radio-globo/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/agostinho-carrara-autonomo-28476/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/freddie/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/bem-te-vi-passaro-58874/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/grito-do-tom-35478/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/what-bottom-text-meme-sanctuary-guardian-s-24591/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/acorda-monark-17462/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/me-mata-de-uma-vez-trio-parada-dura-572/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/me-mata-de-uma-vez-31687/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/aumenta-o-som-marcelo-dig-dig-dig-74686/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/vinheta-jornal-nacional/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/cr7-bom-dia-34785/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/bad-to-the-bone-meme-22189/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/ai-programa-hora-do-faro-melhor-qualidade-5308/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/donald-trump-build-a-wall/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/quien-estaba-hablando-contigo-73597/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/bom-dia-sao-10h-silvio-santos/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/comercial-de-xampu-de-mulher/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/avocados-fron-mexico-5538/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/comercial-globo-1-621/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/comercial-globo-2-83971/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/e-o-pintinho-piu-26037/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/bilu-o-et-brasileiro/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/som-motor-f1-51289/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/buzina-de-caminhao-byrm-17163/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/caminhao-de-gas/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/re-caminhao-67082/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/o-moco-o-caminhao-tombou-35530/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/toque-do-motorola-28486/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/encara-messi-23845/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/cr7-vou-ao-u-ao-messi-36080/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/linkin-park-in-the-end-versao-forro-brazil-79061/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/vx-without-me-forro-estourado-27992/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/minha-pomba-forro-21153/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/champions-league-forro-42023/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/tu-conhece-a-paola-63959/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/lula-feijao-puro-34490/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/chora-viola/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/sinonimos-chitaozinho-xororo-brasil-27832/embed/" frameborder="0" scrolling="no"></iframe>',
    '<iframe width="110" height="200" src="https://www.myinstants.com/instant/eu-to-maluco-to-doente-to-doidao-14644/embed/" frameborder="0" scrolling="no"></iframe>'
];

        // FUNÇÕES REMOVIDAS: sanitizeFileName, getFileList, saveFileList, renderFileList, deleteFile (relacionadas a múltiplos arquivos)

        /**
         * Salva apenas as estatísticas do simulado embutido no localStorage.
         * @param {object} statsObject - O objeto de estatísticas a ser salvo.
         */
        function saveStats(statsObject) {
            localStorage.setItem(LOCAL_STORAGE_STATS_PREFIX + EMBEDDED_QUIZ_ID, JSON.stringify(statsObject));
        }

        /**
         * Carrega o simulado embutido (questões e estatísticas) e prepara para iniciar.
         */
        function loadEmbeddedQuizAndShowOptions() {
            const displayName = "Simulado Principal"; // Nome fixo para o simulado embutido
            const statsString = localStorage.getItem(LOCAL_STORAGE_STATS_PREFIX + EMBEDDED_QUIZ_ID);

            // Processa as questões embutidas para garantir IDs únicos
            allQuestions = embeddedQuestionsSource.map((q, index) => ({
                ...q,
                id: q.id || `${EMBEDDED_QUIZ_ID}-q-${index}` // Garante um ID para cada questão
            }));

            if (allQuestions.length === 0) {
                currentQuestionDiv.innerHTML = "<p>Erro: Nenhuma questão embutida configurada.</p>";
                alert('Erro: Nenhuma questão embutida encontrada ou formato inválido.');
                resetStatsBtn.disabled = true;
                return;
            }

            quizTitleElement.textContent = `Simulado: ${displayName}`;
            resultsTitleElement.textContent = `Resultados: ${displayName}`;

            if (statsString) {
                testStatistics = JSON.parse(statsString);
                testStatistics.questionMistakes = testStatistics.questionMistakes || {};
                allQuestions.forEach(q => { // Garante que todas as questões atuais tenham uma entrada em questionMistakes
                    if (testStatistics.questionMistakes[q.id] === undefined) {
                        testStatistics.questionMistakes[q.id] = 0;
                    }
                });
                currentAttempt = testStatistics.attemptCount || 0;
            } else { // Se não há estatísticas salvas, inicializa
                testStatistics = { 
                    correct: [], 
                    incorrect: [], 
                    attemptsHistory: [], 
                    performanceByArea: {}, 
                    questionMistakes: {}, 
                    attemptCount: 0 
                };
                allQuestions.forEach(q => { testStatistics.questionMistakes[q.id] = 0; });
                currentAttempt = 0;
            }
            
            resultsPage.style.display = 'none'; 
            quizPage.style.display = 'none'; 
            showQuizStartOptionsPopup(displayName);
            resetStatsBtn.disabled = !statsString; // Habilita se houver estatísticas salvas
        }
        
        /**
         * Exibe o popup com opções para iniciar o simulado.
         * @param {string} displayName - O nome de exibição do simulado.
         */
        function showQuizStartOptionsPopup(displayName) {
            quizOptionsPopupSubtitle.textContent = `Simulado: ${displayName}`;
            quizOptionsPopupButtons.innerHTML = ''; 

            const normalTestButton = document.createElement('button');
            normalTestButton.textContent = 'Prova Normal (40Q)'; // Ou o número de questões embutidas se for menor
            normalTestButton.className = 'popup-button'; 
            normalTestButton.onclick = () => {
                initializeTest(false, Math.min(40, allQuestions.length)); // Ajusta o número de questões se necessário
                closeQuizOptionsPopup();
            };
            quizOptionsPopupButtons.appendChild(normalTestButton);

            const distinctMistakesCount = Object.values(testStatistics.questionMistakes || {}).filter(count => count > 0).length;
            
            // Mostra opção de revisar erros apenas se houver erros registrados
            if (distinctMistakesCount > 0) { 
                const reviewMistakesButton = document.createElement('button');
                const reviewQuizLength = Math.min(10, distinctMistakesCount); 
                reviewMistakesButton.textContent = `Revisar Erros (${reviewQuizLength}Q)`;
                reviewMistakesButton.className = 'popup-button';
                reviewMistakesButton.onclick = () => {
                    initializeTest(true, 10); 
                    closeQuizOptionsPopup();
                };
                quizOptionsPopupButtons.appendChild(reviewMistakesButton);
            }
            
            quizStartOptionsPopup.classList.add('active');
        }

        function closeQuizOptionsPopup() {
            quizStartOptionsPopup.classList.remove('active');
        }
        
        resetStatsBtn.addEventListener('click', () => {
            const currentFileNameForAlert = "Simulado Principal";

            if (confirm(`Tem a certeza que quer resetar todas as estatísticas (histórico de tentativas, erros, etc.) do "${currentFileNameForAlert}"? As questões em si NÃO serão apagadas.`)) {
                testStatistics = { 
                    correct: [],
                    incorrect: [],
                    attemptsHistory: [],
                    performanceByArea: {},
                    questionMistakes: {}, 
                    attemptCount: 0 
                };
                // Re-inicializa a contagem de erros para todas as questões embutidas
                allQuestions.forEach(q => { 
                    testStatistics.questionMistakes[q.id] = 0;
                });

                saveStats(testStatistics); // Salva as estatísticas resetadas
                
                alert("Estatísticas resetadas com sucesso!");
                
                if(resultsPage.style.display === 'block'){
                    resultsPage.style.display = 'none';
                }
                if(quizPage.style.display === 'block'){
                     quizPage.style.display = 'none';
                }
                currentQuestionDiv.innerHTML = ""; // Limpa a área de questão
                
                // Recarrega as opções de início, já que as estatísticas foram alteradas
                loadEmbeddedQuizAndShowOptions();
            }
        });


        function playSound(soundElement) {
            if (soundElement) {
                soundElement.currentTime = 0;
                soundElement.play().catch(e => console.error("Erro ao tocar som:", e));
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkModeGlobalSetting', isDark ? 'enabled' : 'disabled'); 
            const text = isDark ? 'Modo Claro' : 'Modo Escuro';
            darkModeText.textContent = text;
            darkModeTextResults.textContent = text;
            if (resultsPage.style.display === 'block' && currentFileId) updateCharts(); 
        }

        if (localStorage.getItem('darkModeGlobalSetting') === 'enabled') {
            document.body.classList.add('dark-mode');
            darkModeText.textContent = 'Modo Claro';
            darkModeTextResults.textContent = 'Modo Claro';
        } else {
             darkModeText.textContent = 'Modo Escuro';
            darkModeTextResults.textContent = 'Modo Escuro';
        }

        darkModeToggle.addEventListener('click', toggleDarkMode);
        darkModeToggleResults.addEventListener('click', toggleDarkMode);
        closeFeedback.addEventListener('click', () => feedbackPopup.classList.remove('active'));
        
        toggleAnalysisBtn.addEventListener('click', () => {
            const isHidden = analysisBox.style.display === 'none' || analysisBox.style.display === '';
            analysisBox.style.display = isHidden ? 'block' : 'none';
            if (isHidden) {
                toggleAnalysisBtn.innerHTML = '<span class="icon">&#x25B2;</span>Recolher Análise';
                toggleAnalysisBtn.classList.add('expanded');
            } else {
                toggleAnalysisBtn.innerHTML = '<span class="icon">&#x25BC;</span>Expandir Análise';
                toggleAnalysisBtn.classList.remove('expanded');
            }
        });
        
        continueButton.addEventListener('click', () => {
            feedbackPopup.classList.remove('active');
            if (currentQuestionIndex < currentTestQuestions.length - 1) { 
                currentQuestionIndex++;
                displayCurrentQuestion(); 
            } else { // Se era o feedback do último bloco da última questão
                actuallyFinishTest();
            }
        });

        // REMOVIDO: jsonInput.addEventListener('change', ...)

        function initializeTest(isMistakesQuiz = false, numQuestions = 40) {
            instantFeedback.style.display = 'none'; 
            instantFeedback.textContent = '';
            currentQuizIsReviewMode = isMistakesQuiz; 
            hasFinishedCurrentTestProcessing = false; 

            // A verificação de currentFileId não é mais crítica aqui, pois é fixo.
            // allQuestions é preenchido por loadEmbeddedQuizAndShowOptions
            if (allQuestions.length === 0) {
                currentQuestionDiv.innerHTML = "<p>Nenhuma questão carregada. Verifique a configuração das questões embutidas.</p>";
                quizPage.style.display = 'block'; 
                return;
            }
            userAnswers = {}; 
            currentQuestionIndex = 0;
            answeredQuestions = 0;
            answeredInBlock = 0;
            correctInBlock = 0;
            showFeedbackOnNext = false;
            testStatistics.correct = []; 
            testStatistics.incorrect = []; 
            testStatistics.performanceByArea = {}; 
            
            // Incrementa o contador de tentativas apenas para provas normais
            if (!isMistakesQuiz) {
                testStatistics.attemptCount = (testStatistics.attemptCount || 0) + 1;
                currentAttempt = testStatistics.attemptCount; 
                saveStats(testStatistics); // Salva o contador de tentativas atualizado
            }


            if (isMistakesQuiz) {
                currentTestQuestions = getMostMistakenQuestions(allQuestions, numQuestions); 
                if (currentTestQuestions.length === 0 ) {
                    alert("Não há questões erradas para revisar ou elas já foram vistas. Iniciando prova normal.");
                    currentTestQuestions = getRandomQuestions(allQuestions, Math.min(40, allQuestions.length)); 
                    numQuestions = currentTestQuestions.length; // Ajusta numQuestions para o tamanho real
                    currentQuizIsReviewMode = false; 
                } else if (currentTestQuestions.length < numQuestions) {
                    numQuestions = currentTestQuestions.length;
                }
            } else { 
                // Lógica para alternar para revisão de erros a cada X tentativas (ex: 6)
                if (testStatistics.attemptCount > 0 && testStatistics.attemptCount % 6 === 0) { 
                    const mistakenForReview = getMostMistakenQuestions(allQuestions, numQuestions);
                    if (mistakenForReview.length > 0) {
                        currentTestQuestions = mistakenForReview;
                        currentQuizIsReviewMode = true; 
                         if (currentTestQuestions.length < numQuestions) numQuestions = currentTestQuestions.length;
                        alert("Esta é uma rodada de revisão das questões mais erradas!");
                    } else { // Se não há erros para revisar, faz uma prova normal
                        currentTestQuestions = getRandomQuestions(allQuestions, Math.min(numQuestions, allQuestions.length));
                        currentQuizIsReviewMode = false;
                         if (currentTestQuestions.length < numQuestions) numQuestions = currentTestQuestions.length;
                    }
                } else { // Prova normal padrão
                    currentTestQuestions = getRandomQuestions(allQuestions, Math.min(numQuestions, allQuestions.length));
                    currentQuizIsReviewMode = false;
                     if (currentTestQuestions.length < numQuestions) numQuestions = currentTestQuestions.length;
                }
            }
            
            // Garante que não tentaremos exibir mais questões do que temos
            if (currentTestQuestions.length > numQuestions) {
                 currentTestQuestions = currentTestQuestions.slice(0, numQuestions);
            } else {
                numQuestions = currentTestQuestions.length; // Ajusta numQuestions para o número real de questões selecionadas
            }

            if (currentTestQuestions.length === 0 && allQuestions.length > 0) { // Fallback se a seleção de erros não retornar nada
                currentTestQuestions = getRandomQuestions(allQuestions, Math.min(numQuestions, allQuestions.length));
                currentQuizIsReviewMode = false; 
            }


            quizPage.style.display = 'block'; 
            resultsPage.style.display = 'none';
            analysisBox.style.display = 'none'; 
            toggleAnalysisBtn.innerHTML = '<span class="icon">&#x25BC;</span>Expandir Análise';
            toggleAnalysisBtn.classList.remove('expanded');

            if (currentTestQuestions.length > 0) {
                displayCurrentQuestion();
            } else {
                currentQuestionDiv.innerHTML = "<p>Nenhuma questão disponível para este modo de prova.</p>";
                nextBtn.disabled = true;
                finishBtn.style.display = 'none';
            }
            updateProgressBar();
            updateNavigationButtons();
        }

        function getRandomQuestions(questions, count) {
            if (questions.length === 0) return [];
            const availableQuestions = questions.length;
            const numToSelect = Math.min(count, availableQuestions);
            const shuffled = [...questions].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, numToSelect);
        }

        function getMostMistakenQuestions(questions, count) {
            if (questions.length === 0 || !testStatistics.questionMistakes) return [];
            const questionsWithMistakes = questions
                .map(q => ({ ...q, mistakes: testStatistics.questionMistakes[q.id] || 0 }))
                .filter(q => q.mistakes > 0);

            questionsWithMistakes.sort((a, b) => b.mistakes - a.mistakes); // Mais erradas primeiro
            
            const numToSelect = Math.min(count, questionsWithMistakes.length);
            const selected = questionsWithMistakes.slice(0, numToSelect);
            return shuffleArray(selected); // Embaralha as selecionadas para não virem sempre na mesma ordem de erro
        }
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function formatEnunciado(text) {
            if (!text) return '';
            const tableRegex = /(\+[-]+\+[\s\S]*\+[-]+\+)/g; 
            return text.replace(tableRegex, '<pre class="ascii-table">$&</pre>');
        }

        function displayCurrentQuestion() {
            instantFeedback.style.display = 'none'; 

            if (currentTestQuestions.length === 0 || currentQuestionIndex >= currentTestQuestions.length) {
                if (answeredQuestions > 0) actuallyFinishTest(); 
                else currentQuestionDiv.innerHTML = "<p>Fim das questões ou nenhuma questão carregada.</p>";
                return;
            }
            const question = currentTestQuestions[currentQuestionIndex];
            let imageHtml = '';
            if (question.imagem && question.imagem !== 'null') {
                imageHtml = `<img src="${question.imagem}" alt="Imagem da questão" class="question-image">`;
            }
            const formattedEnunciado = formatEnunciado(question.enunciado);

            let starsHtml = '';
            if (currentQuizIsReviewMode && testStatistics.questionMistakes && testStatistics.questionMistakes[question.id]) {
                const errorCount = testStatistics.questionMistakes[question.id];
                if (errorCount > 0) { 
                    let starCount = 0;
                    // Lógica de estrelas: 1 estrela para 1-2 erros, 2 estrelas para 3-4 erros, etc.
                    // Ajuste esta lógica conforme necessário.
                    if (errorCount >= 1 && errorCount <=2) starCount = 1;
                    else if (errorCount >= 3 && errorCount <=4) starCount = 2;
                    else if (errorCount >= 5) starCount = 3; // Máximo de 3 estrelas, por exemplo

                    starCount = Math.min(3, starCount); // Limita o número de estrelas

                    if (starCount > 0) {
                        starsHtml = `<span class="mistake-stars-container">${'⭐'.repeat(starCount)} <span class="mistake-stars-label">(Nível de Erro)</span></span>`;
                    }
                }
            }


            currentQuestionDiv.innerHTML = `
                <div class="question-container" id="questionContainer">
                    <div class="question-number">Questão ${currentQuestionIndex + 1} de ${currentTestQuestions.length} ${starsHtml}</div>
                    <div class="question-text">${formattedEnunciado}</div>
                    ${imageHtml}
                    <div class="options" id="optionsContainer"></div>
                    <div class="correct-answer" id="correctAnswer" style="display:none;">Resposta correta: ${question.correta.toUpperCase()}</div>
                    ${question.explicacao ? `<div class="explanation" id="explanation" style="display:none;">${formatEnunciado(question.explicacao)}</div>` : ''}
                </div>`;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = ''; 
            
            Object.entries(question.alternativas).forEach(([letter, text]) => {
                const optionId = `q${currentQuestionIndex}-opt-${letter}-${Date.now()}`;
                const label = document.createElement('label');
                label.className = 'option';
                label.htmlFor = optionId;

                const radioInput = document.createElement('input');
                radioInput.type = 'radio';
                radioInput.id = optionId;
                radioInput.name = `question-${question.id}`; 
                radioInput.value = letter;

                if (userAnswers[question.id] !== undefined) { // Se a questão já foi respondida nesta tentativa
                    radioInput.checked = (userAnswers[question.id] === letter);
                    radioInput.disabled = true; 
                     if (userAnswers[question.id] === letter) { 
                        label.classList.add(userAnswers[question.id] === question.correta ? 'correct' : 'incorrect', 'selected');
                    } else if (letter === question.correta) { 
                        label.classList.add('correct');
                    }
                }
                
                const letterSpan = document.createElement('span');
                letterSpan.className = 'option-letter-styled';
                letterSpan.textContent = `${letter.toUpperCase()})`;

                const textSpan = document.createElement('span');
                textSpan.className = 'option-actual-text';
                textSpan.textContent = text;

                label.appendChild(radioInput);
                label.appendChild(letterSpan);
                label.appendChild(textSpan);
                optionsContainer.appendChild(label);

                if (!radioInput.disabled) { 
                    label.addEventListener('click', function() {
                        if (userAnswers[question.id] !== undefined) return; 

                        userAnswers[question.id] = radioInput.value;
                        radioInput.checked = true;

                        const isCorrect = radioInput.value === question.correta;
                        playSound(isCorrect ? correctSound : wrongSound);

                        optionsContainer.querySelectorAll('label.option').forEach(optLabel => {
                            const optRadio = optLabel.querySelector('input[type="radio"]');
                            optRadio.disabled = true;
                            optLabel.classList.remove('selected', 'correct', 'incorrect');
                            if (optRadio.value === question.correta) {
                                optLabel.classList.add('correct');
                            }
                            if (optRadio.value === radioInput.value) { 
                                optLabel.classList.add('selected');
                                if (!isCorrect) {
                                    optLabel.classList.add('incorrect');
                                }
                            }
                        });
                        
                        const qContainer = document.getElementById('questionContainer');
                        qContainer.classList.remove('correct', 'incorrect');
                        qContainer.classList.add(isCorrect ? 'correct' : 'incorrect');
                        
                        document.getElementById('correctAnswer').style.display = 'block';
                        const explanationDiv = document.getElementById('explanation');
                        if (explanationDiv) explanationDiv.style.display = 'block';

                        answeredQuestions++;
                        answeredInBlock++;
                        if (isCorrect) correctInBlock++;
                        
                        updateProgressBar();
                        // MODIFICAÇÃO: Mudar bloco de 5 para 10
                        if (answeredInBlock > 0 && answeredInBlock % 10 === 0) { 
                            showFeedbackOnNext = true;
                        }
                        updateNavigationButtons();
                    });
                }
            });

            const qContainer = document.getElementById('questionContainer');
            if (userAnswers[question.id] !== undefined) { // Se já respondida, mostrar estado correto/incorreto
                 document.getElementById('correctAnswer').style.display = 'block';
                 const explanationDiv = document.getElementById('explanation');
                 if (explanationDiv) explanationDiv.style.display = 'block';
                 qContainer.classList.toggle('correct', userAnswers[question.id] === question.correta);
                 qContainer.classList.toggle('incorrect', userAnswers[question.id] !== question.correta);
            }
            
            updateNavigationButtons();
            currentQuestionDiv.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
        }

        function showCongratsPopupWithRandomIframe() {
            const existingPopup = document.querySelector('.congrats-popup');
            if (existingPopup) existingPopup.remove();

            // MODIFICAÇÃO: Usar a variável global 'iframes'
            const randomIframeHtml = iframes[Math.floor(Math.random() * iframes.length)];
            const popup = document.createElement('div');
            popup.className = 'congrats-popup';
            popup.innerHTML = `
                <div class="congrats-content">
                    <p class="congrats-message">Parabéns! Você tirou 7+! (áudios 100% aleatório de um site de áudio, CUIDADO!!) </p>
                    <div class="random-iframe">${randomIframeHtml}</div>
                    <button class="close-popup-button" onclick="this.closest('.congrats-popup').remove()">Fechar</button>
                </div>`;
            document.body.appendChild(popup);
        }
        
        function showBlockFeedback() {
            const totalInBlock = answeredInBlock;
            if (totalInBlock === 0 && !showFeedbackOnNext) { 
                 if (currentQuestionIndex < currentTestQuestions.length - 1) {
                     currentQuestionIndex++; 
                     displayCurrentQuestion(); 
                 } else { 
                     actuallyFinishTest(); 
                 }
                return;
            }
            showFeedbackOnNext = false; 

            const incorrectInBlock = totalInBlock - correctInBlock;
            const percentage = totalInBlock > 0 ? Math.round((correctInBlock / totalInBlock) * 100) : 0;
            
            feedbackTotal.textContent = totalInBlock;
            feedbackCorrect.textContent = correctInBlock;
            feedbackIncorrect.textContent = incorrectInBlock;
            feedbackPercentageValue.textContent = percentage;
            
            feedbackMistakesList.innerHTML = '<h4>Resumo dos erros neste bloco:</h4>';
            let mistakesContent = '';
            
            const blockStartIndex = Math.max(0, (currentQuestionIndex +1) - totalInBlock);


            for(let i = 0; i < totalInBlock; i++) {
                const qIdxInTest = blockStartIndex + i;
                 if (qIdxInTest >= currentTestQuestions.length) continue;

                const question = currentTestQuestions[qIdxInTest];
                const userAnswer = userAnswers[question.id];

                if(userAnswer !== undefined && userAnswer !== question.correta) {
                    mistakesContent += `<div class="feedback-mistake-item">
                        <div class="feedback-mistake-question">Q${qIdxInTest + 1}: ${question.enunciado.substring(0,50)}...</div>
                        <div class="feedback-mistake-option feedback-mistake-selected">Sua Resposta: ${userAnswer.toUpperCase()}) ${question.alternativas[userAnswer]}</div>
                        <div class="feedback-mistake-option feedback-mistake-correct">Correta: ${question.correta.toUpperCase()}) ${question.alternativas[question.correta]}</div>
                    </div>`;
                }
            }
            if(mistakesContent === '') mistakesContent = "<p>Nenhum erro neste bloco. Ótimo!</p>";
            feedbackMistakesList.innerHTML += mistakesContent;
            
            feedbackPopup.classList.add('active');

            if (percentage >= 70) {
                setTimeout(showCongratsPopupWithRandomIframe, 300);
            }
            
            answeredInBlock = 0; 
            correctInBlock = 0;  
        }

        function showInstantFeedback() {
            if (currentTestQuestions.length === 0 || currentQuestionIndex >= currentTestQuestions.length) return;
            const question = currentTestQuestions[currentQuestionIndex];
            const userAnswer = userAnswers[question.id];
            if (userAnswer === undefined) { instantFeedback.style.display = 'none'; return; }
            const isCorrect = userAnswer === question.correta;
            instantFeedback.textContent = isCorrect ? `✅ Resposta correta! (${question.correta.toUpperCase()})` : `❌ Resposta incorreta! A correta é ${question.correta.toUpperCase()}`;
            instantFeedback.className = isCorrect ? 'instant-feedback correct' : 'instant-feedback incorrect';
            instantFeedback.style.display = 'block';
            setTimeout(() => instantFeedback.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
        }

        function updateProgressBar() {
            const progress = currentTestQuestions.length > 0 ? (answeredQuestions / currentTestQuestions.length) * 100 : 0;
            progressBar.style.width = `${progress}%`;
        }

        function updateNavigationButtons() {
            prevBtn.disabled = currentQuestionIndex === 0;
            const questionId = currentTestQuestions[currentQuestionIndex]?.id;
            const answeredCurrent = userAnswers[questionId] !== undefined;
            
            if (currentQuestionIndex === currentTestQuestions.length - 1) { // Se é a última questão
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'block';
                finishBtn.disabled = !answeredCurrent; // Habilita finalizar apenas se a última foi respondida
            } else { // Não é a última questão
                nextBtn.style.display = 'block';
                finishBtn.style.display = 'none';
                nextBtn.disabled = !answeredCurrent; // Habilita próxima apenas se a atual foi respondida
            }
            if(currentQuestionIndex > 0) prevBtn.disabled = false; // Se não for a primeira, botão anterior sempre habilitado
        }

        function nextQuestion() {
            showInstantFeedback(); 

            if (showFeedbackOnNext) { 
                showBlockFeedback(); 
            } else {
                if (currentQuestionIndex < currentTestQuestions.length - 1) {
                    setTimeout(() => { 
                        currentQuestionIndex++;
                        displayCurrentQuestion();
                    }, 300); // Delay apenas se não houver feedback de bloco
                }
            }
        }


        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayCurrentQuestion();
            }
        }
        
        function finishTest() {
            const currentQuestionId = currentTestQuestions[currentQuestionIndex]?.id;
            if(userAnswers[currentQuestionId] === undefined && currentQuestionIndex === currentTestQuestions.length -1) {
                alert("Por favor, responda à questão atual antes de finalizar.");
                return; 
            }

            showInstantFeedback(); 

            if (showFeedbackOnNext && currentQuestionIndex === currentTestQuestions.length - 1) {
                showBlockFeedback(); 
            } else {
                actuallyFinishTest(); 
            }
        }

        function actuallyFinishTest() {
             if (hasFinishedCurrentTestProcessing) {
                console.warn("actuallyFinishTest: Processamento já realizado para esta tentativa. Exibindo resultados existentes.");
                const lastAttempt = testStatistics.attemptsHistory && testStatistics.attemptsHistory.length > 0 
                                     ? testStatistics.attemptsHistory[testStatistics.attemptsHistory.length -1]
                                     : null;
                if(lastAttempt && typeof lastAttempt.total === 'number' && lastAttempt.total > 0) { 
                    showResultsPage(parseFloat(lastAttempt.score), (lastAttempt.correct / lastAttempt.total) * 100, lastAttempt.correct, lastAttempt.total);
                } else { 
                    showResultsPage(0, 0, 0, 0); 
                }
                return;
            }


            const delay = userAnswers[currentTestQuestions[currentQuestionIndex]?.id] !== undefined ? 300 : 0;
            setTimeout(() => {
                // currentFileId é sempre EMBEDDED_QUIZ_ID, não precisa checar se é null
                
                testStatistics.correct = [];
                testStatistics.incorrect = [];
                testStatistics.performanceByArea = {}; 
                
                currentTestQuestions.forEach((question) => {
                    const userAnswer = userAnswers[question.id]; 
                    if (userAnswer === undefined) return; 

                    if (question.area) {
                        if (!testStatistics.performanceByArea[question.area]) {
                            testStatistics.performanceByArea[question.area] = { correct: 0, total: 0 };
                        }
                        testStatistics.performanceByArea[question.area].total++;
                    }

                    if (userAnswer === question.correta) {
                        testStatistics.correct.push(question.id);
                        if (question.area) {
                            testStatistics.performanceByArea[question.area].correct++;
                        }
                    } else {
                        testStatistics.incorrect.push(question.id);
                        testStatistics.questionMistakes[question.id] = (testStatistics.questionMistakes[question.id] || 0) + 1;
                    }
                });
                
                const correctCount = testStatistics.correct.length;
                const totalAnsweredInTest = correctCount + testStatistics.incorrect.length;
                
                const correctPercentage = totalAnsweredInTest > 0 ? ((correctCount / totalAnsweredInTest) * 100) : 0; 
                const finalScore = totalAnsweredInTest > 0 ? ((correctCount / totalAnsweredInTest) * 10) : 0; 
                
                if (totalAnsweredInTest > 0) { // Salva no histórico apenas se houver respostas
                    if (!testStatistics.attemptsHistory) testStatistics.attemptsHistory = [];
                    testStatistics.attemptsHistory.push({
                        date: new Date().toLocaleString(),
                        correct: correctCount,
                        total: totalAnsweredInTest,
                        score: finalScore.toFixed(1),
                        attemptNumber: testStatistics.attemptCount, 
                        questionIdsInAttempt: currentTestQuestions.map(q => q.id),
                        userAnswersInAttempt: {...userAnswers} 
                    });
                }
                
                saveStats(testStatistics); // Salva estatísticas atualizadas
                hasFinishedCurrentTestProcessing = true; 
                showResultsPage(finalScore, correctPercentage, correctCount, totalAnsweredInTest);
            }, delay);
        }

        function showResultsPage(score, percentage, correctCount, totalAttempted) {
            quizPage.style.display = 'none';
            resultsPage.style.display = 'block';

            const resultsMainBox = document.getElementById('results-main-box');
            resultsMainBox.classList.remove('results-box-bad', 'results-box-average', 'results-box-good');
            if (score < 6) {
                resultsMainBox.classList.add('results-box-bad');
            } else if (score < 8) {
                resultsMainBox.classList.add('results-box-average');
            } else {
                resultsMainBox.classList.add('results-box-good');
            }

            const finalScoreBox = document.getElementById('finalScoreText');
            finalScoreBox.textContent = `${score.toFixed(1)}`;
            finalScoreBox.className = 'final-score-value-box'; 
            if (score < 6) {
                finalScoreBox.classList.add('score-bad');
            } else if (score < 8) {
                finalScoreBox.classList.add('score-average');
            } else {
                finalScoreBox.classList.add('score-good');
            }
            
            finalPercentageText.innerHTML = `Você acertou <strong>${correctCount}</strong> de <strong>${totalAttempted}</strong> questões respondidas (<strong>${percentage.toFixed(1)}%</strong>)`;
            
            destroyCharts();
            generateCharts(); 
            generateQuestionsAnalysis(); 
            resetStatsBtn.disabled = false; // Habilita o botão de reset, pois há um resultado para o simulado
            
            const resultsTitleEl = document.getElementById('resultsTitle');
            if(resultsTitleEl) {
                resultsTitleEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function destroyCharts() { 
            Object.keys(charts).forEach(key => {
                if (charts[key] && typeof charts[key].destroy === 'function') {
                    charts[key].destroy();
                }
                charts[key] = null;
            });
        }
        
        function updateCharts() { 
            destroyCharts(); 
            setTimeout(() => {
                generateCharts();
            }, 50);
        }

        function generateCharts() {
            // currentFileId é sempre EMBEDDED_QUIZ_ID, não precisa checar
            destroyCharts(); 
            
            const textColor = getComputedStyle(document.body).getPropertyValue('--text-primary').trim();
            const borderColorCSS = getComputedStyle(document.body).getPropertyValue('--border-color').trim();
            const correctColor = getComputedStyle(document.body).getPropertyValue('--accent-color').trim();
            const incorrectColor = getComputedStyle(document.body).getPropertyValue('--danger-color').trim();
            const primaryColor = getComputedStyle(document.body).getPropertyValue('--primary-color').trim();
            const bgCardColor = getComputedStyle(document.body).getPropertyValue('--bg-card').trim();

            const correctAnswersCount = testStatistics.correct.length;
            const incorrectAnswersCount = testStatistics.incorrect.length;

            // Gráfico de Desempenho Geral (Pizza)
            if (correctAnswersCount > 0 || incorrectAnswersCount > 0) { // Só mostra se houver dados
                charts.performance = new Chart(document.getElementById('performanceChart').getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Acertos', 'Erros'],
                        datasets: [{
                            data: [correctAnswersCount, incorrectAnswersCount],
                            backgroundColor: [correctColor, incorrectColor],
                            borderColor: bgCardColor, borderWidth: 2
                        }]
                    },
                    options: getChartOptions('Desempenho na Prova Atual', textColor)
                });
            }


            // Gráfico de Progresso nas Tentativas (Barras)
            const attemptLabels = (testStatistics.attemptsHistory || []).map((a, i) => `Tent. ${a.attemptNumber || i + 1}`);
            const attemptScores = (testStatistics.attemptsHistory || []).map(a => parseFloat(a.score));
            if (attemptLabels.length > 0) { // Só mostra se houver histórico
                charts.progress = new Chart(document.getElementById('progressChart').getContext('2d'), {
                    type: 'bar', 
                    data: {
                        labels: attemptLabels,
                        datasets: [{
                            label: 'Nota (0-10)', 
                            data: attemptScores, 
                            backgroundColor: primaryColor + 'B3', 
                            borderColor: primaryColor,
                            borderWidth: 1
                        }]
                    },
                    options: getChartOptions('Progresso nas Tentativas (Neste Simulado)', textColor, {
                        scales: { 
                            y: { beginAtZero: true, max: 10, ticks: { color: textColor, stepSize: 1 }, grid: { color: borderColorCSS + '80' } },
                            x: { ticks: { color: textColor }, grid: { color: borderColorCSS + '80' } } 
                        },
                        animation: { // Para mostrar o valor em cima da barra
                            onComplete: function() {
                                const chartInstance = this;
                                const ctx = chartInstance.ctx;
                                const fontFam = getComputedStyle(document.body).getPropertyValue('--font-main').split(',')[0].trim() || 'Poppins';
                                ctx.font = `600 11px ${fontFam}`;
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'bottom';
                                ctx.fillStyle = textColor;

                                this.data.datasets.forEach(function(dataset, i) {
                                    const meta = chartInstance.getDatasetMeta(i);
                                    if (!meta.hidden) {
                                        meta.data.forEach(function(bar, index) {
                                            const data = dataset.data[index];
                                            if (data !== null && data !== undefined) {
                                                const score = parseFloat(data).toFixed(1);
                                                ctx.fillText(score, bar.x, bar.y - 6); 
                                            }
                                        });
                                    }
                                });
                            }
                        }
                    })
                });
            }
            
            // Gráfico de Acertos por Área (Barras Horizontais)
            const areaLabels = Object.keys(testStatistics.performanceByArea || {});
            const areaPerformance = areaLabels.map(area => {
                const data = testStatistics.performanceByArea[area];
                return data.total > 0 ? (data.correct / data.total) * 100 : 0;
            });
            
            const areasChartCard = document.getElementById('areasChartCard');
            if (areasChartCard && areaLabels.length > 0) { // Só mostra se houver áreas e dados
                areasChartCard.style.display = 'block'; 
                charts.areas = new Chart(document.getElementById('areasChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: areaLabels,
                        datasets: [{
                            label: '% Acerto por Área (Prova Atual)', data: areaPerformance, backgroundColor: primaryColor + 'B3',
                            borderColor: primaryColor, borderWidth: 1
                        }]
                    },
                    options: getChartOptions('Desempenho por Área (Prova Atual)', textColor, {
                        indexAxis: 'y',
                        scales: { 
                            y: { ticks: { color: textColor }, grid: { color: borderColorCSS + '80' } },
                            x: { beginAtZero: true, max: 100, ticks: { color: textColor, callback: function(value) { return value + "%" } }, grid: { color: borderColorCSS + '80' } }
                        }
                    })
                });
            } else if (areasChartCard) {
                areasChartCard.style.display = 'none'; 
            }

            // Gráfico de Questões Mais Erradas (Barras)
            const mistakeCountsOverall = {};
            Object.entries(testStatistics.questionMistakes || {}).forEach(([qId, count]) => {
                if (count > 0) {
                    const originalQuestionIndex = allQuestions.findIndex(q => q.id === qId); 
                    if (originalQuestionIndex !== -1) { 
                        mistakeCountsOverall[`Q${originalQuestionIndex + 1}`] = count;
                    }
                }
            });
            const sortedMistakesOverall = Object.entries(mistakeCountsOverall)
                                                 .sort(([,a],[,b]) => b-a) // Ordena por mais erradas
                                                 .slice(0,10); // Pega o Top 10
            
            if (sortedMistakesOverall.length > 0) { // Só mostra se houver erros
                charts.mistakes = new Chart(document.getElementById('mistakesChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: sortedMistakesOverall.map(item => item[0]),
                        datasets: [{
                            label: 'Vezes Erradas (Top 10 - Este Simulado)', data: sortedMistakesOverall.map(item => item[1]),
                            backgroundColor: incorrectColor + 'B3', borderColor: incorrectColor, borderWidth: 1
                        }]
                    },
                    options: getChartOptions('Questões Mais Erradas (Este Simulado)', textColor, {
                        scales: { 
                            y: { beginAtZero: true, ticks: { color: textColor, stepSize: 1 }, grid: { color: borderColorCSS + '80' } },
                            x: { ticks: { color: textColor }, grid: { color: borderColorCSS + '80' } } 
                        },
                        onClick: (event, elements) => { 
                            if (elements.length > 0) {
                                const chartElement = elements[0];
                                const index = chartElement.index;
                                const questionLabel = charts.mistakes.data.labels[index]; 
                                const questionNumberStr = questionLabel.substring(1); 
                                const questionNumber = parseInt(questionNumberStr); 
                                if (!isNaN(questionNumber) && questionNumber > 0 && questionNumber <= allQuestions.length) {
                                    const questionData = allQuestions[questionNumber - 1]; 
                                    displayQuestionInPopup(questionData);
                                } else {
                                    console.error("Não foi possível encontrar a questão para o label:", questionLabel);
                                }
                            }
                        }
                    })
                });
            }
            generateAdditionalCharts();
        }

        function generateAdditionalCharts() {
            const textColor = getComputedStyle(document.body).getPropertyValue('--text-primary').trim();
            const borderColorCSS = getComputedStyle(document.body).getPropertyValue('--border-color').trim();
            const bgCardColor = getComputedStyle(document.body).getPropertyValue('--bg-card').trim();

            // Gráfico de Tamanho da Questão
            const SMALL_Q_THRESHOLD_NEW = 400; 
            const MEDIUM_Q_THRESHOLD_NEW = 800; 
            let smallQ = 0, mediumQ = 0, longQ = 0;
            
            currentTestQuestions.forEach(q => {
                let totalLength = q.enunciado ? q.enunciado.length : 0;
                if (q.alternativas) {
                    Object.values(q.alternativas).forEach(altText => {
                        if (altText) totalLength += altText.length;
                    });
                }
                if (totalLength < SMALL_Q_THRESHOLD_NEW) smallQ++;
                else if (totalLength < MEDIUM_Q_THRESHOLD_NEW) mediumQ++;
                else longQ++;
            });

            const qSizeColors = [
                'rgba(75, 192, 192, 0.7)',  
                'rgba(255, 206, 86, 0.7)', 
                'rgba(255, 99, 132, 0.7)'   
            ];
            const qSizeBorderColors = [
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(255, 99, 132, 1)'
            ];

            if (smallQ > 0 || mediumQ > 0 || longQ > 0) {
                charts.questionSizeChart = new Chart(document.getElementById('questionSizeChart').getContext('2d'), {
                    type: 'bar', 
                    data: {
                        labels: [`Pequenas (<${SMALL_Q_THRESHOLD_NEW}c)`, `Médias (${SMALL_Q_THRESHOLD_NEW}-${MEDIUM_Q_THRESHOLD_NEW}c)`, `Longas (>${MEDIUM_Q_THRESHOLD_NEW}c)`],
                        datasets: [{ 
                            label: 'Quantidade de Questões', 
                            data: [smallQ, mediumQ, longQ],
                            backgroundColor: qSizeColors,
                            borderColor: qSizeBorderColors,
                            borderWidth: 1 
                        }]
                    },
                    options: getChartOptions('Tamanho de Questão (Enunciado + Alternativas)', textColor, {
                        indexAxis: 'y', 
                        scales: { 
                            x: { beginAtZero: true, ticks: { color: textColor, stepSize: Math.max(1, Math.ceil(Math.max(1, smallQ,mediumQ,longQ) / 5)) }, grid: { color: borderColorCSS + '80' } }, 
                            y: { ticks: { color: textColor }, grid: { display: false } } 
                        },
                        plugins: { legend: { display: false } }
                    })
                });
            }


            // Gráfico de Tempo por Questão (Simulado - dados fictícios por enquanto)
            const timeLabels = currentTestQuestions.slice(0,10).map((q,i) => { // Mostra para as 10 primeiras da prova atual
                const globalIndex = allQuestions.findIndex(aq => aq.id === q.id);
                return `Q${globalIndex !== -1 ? globalIndex + 1 : i + 1}`; // Usa o índice global se possível
            });
            // TODO: Implementar medição real de tempo por questão se desejado.
            // Por agora, dados aleatórios apenas para visualização.
            const timeData = Array.from({length: timeLabels.length}, () => Math.floor(Math.random() * 90) + 30); 
            
            if (timeLabels.length > 0) {
                charts.timePerQuestion = new Chart(document.getElementById('timePerQuestionChart').getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: timeLabels,
                        datasets: [{ 
                            label: 'Tempo (s)', 
                            data: timeData,
                            backgroundColor: 'rgba(54, 162, 235, 0.7)', 
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1 
                        }]
                    },
                    options: getChartOptions('Tempo por Questão (Simulado - Amostra)', textColor, {
                        scales: { 
                            y: { beginAtZero: true, ticks: { color: textColor }, grid: { color: borderColorCSS + '80' } },
                            x: { ticks: { color: textColor }, grid: { color: borderColorCSS + '80' } } 
                        },
                        plugins: { legend: { display: false } }
                    })
                });
            }
        }

        function getChartOptions(title, textColor, customOptions = {}) {
            const gridColor = getComputedStyle(document.body).getPropertyValue('--border-color').trim() + '60'; // Grid mais sutil

            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: textColor, font: { family: 'Poppins', size: 12 } }
                    },
                    title: { display: true, text: title, color: textColor, font: { family: 'Poppins', size: 14, weight: '600' }, padding: {bottom: 10} }
                },
                scales: customOptions.scales ? { // Configuração de eixos se fornecida
                    y: {
                        ...(customOptions.scales.y || {}),
                        ticks: { ...(customOptions.scales.y?.ticks || {}), color: textColor },
                        grid: { ...(customOptions.scales.y?.grid || {}), color: gridColor, drawBorder: false }
                    },
                    x: {
                        ...(customOptions.scales.x || {}),
                        ticks: { ...(customOptions.scales.x?.ticks || {}), color: textColor },
                        grid: { ...(customOptions.scales.x?.grid || {}), color: gridColor, drawBorder: false }
                    }
                } : undefined, // Se não houver custom scales, não define a propriedade scales (útil para gráficos de pizza)
                ...customOptions // Permite sobrescrever ou adicionar outras opções
            };
        }
        
        function displayQuestionInPopup(question) {
            let imageHtml = question.imagem && question.imagem !== 'null' ? `<img src="${question.imagem}" alt="Imagem da questão" class="question-image" style="max-height: 200px; margin-bottom: 15px;">` : '';
            
            let optionsHtml = '<div class="options" style="gap: 8px; pointer-events: none;">'; // Desabilita cliques nas opções do popup
            Object.entries(question.alternativas).forEach(([letter, text]) => {
                let optClass = 'option';
                let optInnerStyle = 'margin-bottom: 8px; border-width: 1px; padding: 10px;';
                
                if (letter === question.correta) {
                    optClass += ' correct'; 
                    // Estilo para destacar a correta no popup
                    optInnerStyle += `background-color: var(--accent-light); border-left-color: var(--accent-color); border-left-width: 4px;`;
                } else {
                     optInnerStyle += `background-color: transparent;`; 
                }

                optionsHtml += `<div class="${optClass}" style="${optInnerStyle}">
                                     <span class="option-letter-styled">${letter.toUpperCase()})</span>
                                     <span class="option-actual-text" style="color: var(--text-primary);">${text}</span>
                                 </div>`;
            });
            optionsHtml += '</div>';

            const formattedEnunciado = formatEnunciado(question.enunciado);
            const formattedExplicacao = question.explicacao ? formatEnunciado(question.explicacao) : '';

            questionDetailContent.innerHTML = `
                <div class="question-container" style="border: none; box-shadow: none; padding:0; margin-bottom:0;">
                    <h4 style="color: var(--primary-color); text-align:left; margin-bottom:10px;">Detalhe da Questão</h4>
                    <div class="question-text" style="margin-bottom:15px; font-size: 1rem;">${formattedEnunciado}</div>
                    ${imageHtml}
                    ${optionsHtml}
                    ${formattedExplicacao ? `<div class="explanation" style="display:block; margin-top: 15px; padding:10px; background-color: var(--bg-main); border-radius: 6px;"><strong style="color:var(--text-secondary);">Explicação:</strong><br>${formattedExplicacao}</div>` : ''}
                </div>
            `;
            questionDetailPopup.classList.add('active');
        }

        function closeQuestionDetailPopup() {
            questionDetailPopup.classList.remove('active');
            questionDetailContent.innerHTML = ''; 
        }

        function generateQuestionsAnalysis() {
            questionsAnalysis.innerHTML = ''; 
            currentTestQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[question.id]; 
                if (userAnswer === undefined) return; // Só analisa questões respondidas na tentativa atual

                const isCorrect = userAnswer === question.correta;
                const questionDiv = document.createElement('div');
                
                questionDiv.className = `question-container ${isCorrect ? 'correct' : 'incorrect'}`;
                questionDiv.style.marginBottom = '20px';

                let imageHtml = question.imagem && question.imagem !== 'null' ? `<img src="${question.imagem}" alt="Imagem da questão" class="question-image">` : '';
                
                let optionsHtml = Object.entries(question.alternativas).map(([letter, text]) => {
                    let optClass = 'option'; 
                    let optStyle = 'pointer-events: none; transform: none; margin-bottom: 8px; border-width: 1px;'; 

                    if (letter === question.correta) optClass += ' correct'; 
                    if (letter === userAnswer && !isCorrect) optClass += ' selected incorrect'; 
                    else if (letter === userAnswer && isCorrect) optClass += ' selected';

                    return `<div class="${optClass}" style="${optStyle}">
                                 <span class="option-letter-styled">${letter.toUpperCase()})</span>
                                 <span class="option-actual-text" style="color: var(--text-primary);">${text}</span>
                             </div>`;
                }).join('');

                let correctAnswerBox = '';
                if (!isCorrect) { // Mostra a caixa de resposta correta apenas se o usuário errou
                    correctAnswerBox = `<div class="analysis-correct-answer">
                        <strong>Resposta Correta: ${question.correta.toUpperCase()})</strong> ${question.alternativas[question.correta]}
                    </div>`;
                }

                const formattedEnunciado = formatEnunciado(question.enunciado);
                const formattedExplicacao = question.explicacao ? formatEnunciado(question.explicacao) : '';

                questionDiv.innerHTML = `
                    <div class="question-number">Questão ${index + 1} - ${isCorrect ? 'Acertou' : 'Errou'}</div>
                    <div class="question-text" style="margin-bottom:15px;">${formattedEnunciado}</div>
                    ${imageHtml}
                    <div class="options" style="gap: 0;">${optionsHtml}</div>
                    ${correctAnswerBox} 
                    ${formattedExplicacao ? `<div class="explanation" style="display:block; margin-top: 15px;">${formattedExplicacao}</div>` : ''}`;
                questionsAnalysis.appendChild(questionDiv);
            });
        }
        
        function startNewAttempt(isMistakesQuizForce = false) {
            if (allQuestions.length === 0) { 
                alert("Nenhuma questão carregada. Verifique a configuração das questões embutidas.");
                return;
            }
            
             if (quizStartOptionsPopup.classList.contains('active')) {
                closeQuizOptionsPopup();
            }
            
            if (isMistakesQuizForce) {
                const distinctMistakesCount = Object.values(testStatistics.questionMistakes || {}).filter(count => count > 0).length;
                if (distinctMistakesCount > 0) { 
                    initializeTest(true, 10); 
                } else {
                     alert("Não há questões erradas para revisar neste simulado. Iniciando prova normal.");
                    initializeTest(false, Math.min(40, allQuestions.length));
                }
            } else {
                initializeTest(false, Math.min(40, allQuestions.length));
            }
        }

        // REMOVIDA: function loadNewFile() { location.reload(); }

        document.addEventListener('DOMContentLoaded', () => {
            quizPage.style.display = 'none'; 
            resultsPage.style.display = 'none'; // Esconde a página de resultados inicialmente
            
            loadEmbeddedQuizAndShowOptions(); // Carrega o simulado embutido e mostra opções

            if (document.body.classList.contains('dark-mode')) {
                darkModeText.textContent = 'Modo Claro';
                darkModeTextResults.textContent = 'Modo Claro';
            } else {
                darkModeText.textContent = 'Modo Escuro';
                darkModeTextResults.textContent = 'Modo Escuro';
            }
        });

    </script>
</body>
</html>
